<!DOCTYPE html>
<html>
<head>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="stylesheet" href="style/metro-bootstrap.min.css" />
	  <link rel="stylesheet" href="style/metro-bootstrap-responsive.min.css" />
    <script src="style/jquery.min.js"></script>
	  <script src="style/jquery.ui.widget.js"></script>	
    <script src="style/metro.min.js"></script>
	  <link rel="stylesheet" href="highlight.css" />

	<meta name="generator" content="DocPad v6.60.4" />
	
    
	<style>
    header {
      height: 45px;
    }
    #content {
      overflow-y: scroll;
	  padding-right: 20px;
	  margin-left: 20px;
    }
    #sidebar {
      display: block;
      float: left;
      width: 300px;
      overflow-y: scroll;
      margin-right:20px;
    }
    body {
      overflow-y: hidden;
     }
	.metro h1 {
		color: #9a1616 !important;
	}	
	.metro .sidebar>ul ul, .metro .sidebar>ul ul li a {
		background-color: #3d3d3d;
		border: 0px;
		color: #fff;
	}
  </style>
    
	<script>
	function adjustHeight() {
		//adjust the height of the content and sidebar
		$("#content").outerHeight(window.innerHeight -45);
		$("#sidebar").outerHeight(window.innerHeight -45);
	}

    $(document).ready(function() {
		var path = window.location.pathname.replace("/scalejs/scalejs-docs/out","");
		
		//make selected page active on sidebar
		$("a[href='." + path +"']").parent().addClass("active");

		adjustHeight();
		$(window).resize(adjustHeight);

		//create code highlighting
		$('pre').each(function() {
			$(this).html($(this).html().replace(/!!\*/g, "<i style='background-color:#FFFF99'>").replace(/\*\*!/g, "</i>"));
		});
    });

  </script>
</head>
<body class="metro">

  <header>
	  <nav class="navigation-bar dark fixed-top">
    <div class="navigation-bar-content">
        <a href="./" class="element"><span class="icon-home"></span> SCALEJS</a>
        <span class="element-divider"></span>

        <a class="element1 pull-menu" href="#"></a>

        <ul class="element-menu no-desktop">
            <li>
                <a class="dropdown-toggle" href="#"><span class="icon-layers"></span> Docs</a>
                <ul class="dropdown-menu dark" data-role="dropdown">
                    <li>
                        <a href="#" class="dropdown-toggle">Getting Started</a>
                        <ul class="dropdown-menu dark" data-role="dropdown">
                            <li><a href="./docs.html"><i class="icon-star-3"></i> Introduction</a></li>
                            <li><a href="./install.html"><i class="icon-download-2"></i> Install Scalejs</a></li>
                            <li><a href="./project.html"><i class="icon-new"></i> Create an Application Project</a></li>
                            <!--<li><a href="./build.html"><i class="icon-cloud"></i> Build and Deployment</a></li>
                            <li><a href="./test.html"><i class="icon-checkmark"></i> Testing</a></li>
                            <li><a href="./best.html"><i class="icon-thumbs-up"></i> Best Practices</a></li>-->
                        </ul>
                    </li>
                    <li>
                        <a href="#" class="dropdown-toggle">Overview</a>
                        <ul class="dropdown-menu dark" data-role="dropdown">
                            <li><a href="./template.html"><i class="icon-clipboard-2"></i> Project Template</a></li>
                            <li><a href="./architecture.html"><i class="icon-puzzle"></i> Architecture</a></li>
                            <li><a href="./mvvm.html"><i class="icon-tree-view"></i> Model-View-ViewModel</a></li>
                            <li><a href="./statechart.html"><i class="icon-tab"></i> Statechart</a></li>
                            <li><a href="./routing.html"><i class="icon-share"></i> Routing</a></li>
                            <li><a href="./composition.html"><i class="icon-screen"></i> UI Composition</a></li>
                            <li><a href="./gridlayout.html"><i class="icon-grid-view"></i> Grid Layout</a></li>
                            <!-- <li><a href="./styles.html"><i class="icon-droplet"></i> Styles</a></li>
                            <li><a href="./extensions.html"><i class="icon-wrench"></i> Extensions</a></li>
                            <li><a href="./api.html"><i class="icon-book"></i> API Documentation</a></li>-->
                        </ul>
                    </li>
                    <li>
                        <a href="#" class="dropdown-toggle">UI Components</a>
                        <ul class="dropdown-menu dark" data-role="dropdown">
                            <li>
                                <a class="dropdown-toggle" href=""><i class="icon-grid"></i> Grid</a>
                                <ul class="dropdown-menu" data-role="dropdown">
                                    <li><a href="./grid1.html">Introduction</a></li>
                                    <li><a href="./grid2.html">Filtering</a></li>
                                    <!--<li><a href="./grid3.html">Sorting</a></li>-->
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" class="dropdown-toggle">Tutorials</a>
                        <ul class="dropdown-menu dark" data-role="dropdown">
                            <li><a href="./todomvc.html">ToDoMVC</a></li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li class="divider"></li>
            <li><a title="Visual Studio Gallery" href="http://visualstudiogallery.msdn.microsoft.com/2a3d0050-ccab-458f-8bfc-2f2aca73e631"><span class="icon-box-add"></span> Visual Studio</a></li>
            <li class="divider"></li>
            <li><a title="GitHub" href="https://github.com/lisovin/scalejs/tree/master"><span class="icon-github-3"></span> GitHub</a></li>
        </ul>

        <div class="no-tablet-portrait no-phone">
            <a href="./docs.html" class="element"><span class="icon-layers"></span> Docs</a>
            <span class="element-divider"></span>

            <a title="Visual Studio Gallery" href="http://visualstudiogallery.msdn.microsoft.com/2a3d0050-ccab-458f-8bfc-2f2aca73e631" class="element place-right"><span class="icon-box-add"></span> Visual Studio</a>
            <span class="element-divider place-right"></span>

            <a title="GitHub" href="https://github.com/lisovin/scalejs/tree/master" class="element place-right"><span class="icon-github-3"></span> GitHub</a>
            <span class="element-divider place-right"></span>
        </div>
    </div>
</nav>
  </header>
  
  <div id="container">
     
       <div id="sidebar" class="sidebar no-tablet-portrait no-phone">
		      <ul>
			      <li class="title">Getting Started</li>
				      <li><a href="./docs.html"><i class="icon-star-3"></i> Introduction</a></li>
				      <li><a href="./install.html"><i class="icon-download-2"></i> Install Scalejs</a></li>
				      <li><a href="./project.html"><i class="icon-new"></i> Create an Application Project</a></li>
                            <!--<li><a href="./build.html"><i class="icon-cloud"></i> Build and Deployment</a></li>
                            <li><a href="./test.html"><i class="icon-checkmark"></i> Testing</a></li>
                            <li><a href="./best.html"><i class="icon-thumbs-up"></i> Best Practices</a></li>-->
			      <li class="title">Overview</li>
                            <li><a href="./template.html"><i class="icon-clipboard-2"></i> Project Template</a></li>
                            <li><a href="./architecture.html"><i class="icon-puzzle"></i> Architecture</a></li>
                            <li><a href="./mvvm.html"><i class="icon-tree-view"></i> Model-View-ViewModel</a></li>
                            <li><a href="./statechart.html"><i class="icon-tab"></i> Statechart</a></li>
                            <li><a href="./routing.html"><i class="icon-share"></i> Routing</a></li>
                            <li><a href="./composition.html"><i class="icon-screen"></i> UI Composition</a></li>
                            <li><a href="./gridlayout.html"><i class="icon-grid-view"></i> Grid Layout</a></li>
                            <!--<li><a href="./styles.html"><i class="icon-droplet"></i> Styles</a></li>
                            <li><a href="./extensions.html"><i class="icon-wrench"></i> Extensions</a></li>
                            <li><a href="./api.html"><i class="icon-book"></i> API Documentation</a></li>-->
				  <li class="title">UI Components</li>
				            <li>
								<a class="dropdown-toggle" href=""><i class="icon-grid"></i> Grid</a>
								<ul class="dropdown-menu" data-role="dropdown" style="display:block !important">
									<li><a href="./grid1.html">Introduction</a></li>
									<li><a href="./grid2.html">Filtering</a></li>
									<!--<li><a href="./grid3.html">Sorting</a></li>-->
								</ul>
							</li>
			      <li class="title">Tutorials</li>
				      <li><a href="./todomvc.html">ToDoMVC</a></li>
		      </ul>
	      </div>

	    <div id="content">
		    <h1 id="todomvc-app-tutorial">ToDoMVC App Tutorial</h1>
<hr>

<p>We will demonstrate how to create a Scalejs application by creating a ToDo MVC app. Scalejs is better suited for creating large and scalable applications, but we will cover some basics with the ToDo MVC app such as:</p>
<ul>
<li>Creating and Rendering Modules</li>
<li>View, View Models, and Bindings</li>
<li>States and Routing</li>
</ul>
<p>This tutorial is created using scalejs v0.3.5. </p>
<p><strong>You can view and clone this application from <a href="https://github.com/egucciar/todomvc/tree/scalejs/labs/architecture-examples/scalejs/ToDoMVC">this repository</a></strong>.
The commit history follows the major steps in this tutorial.</p>
<p><br></p>
<h2 id="1-create-the-project">1. Create the Project</h2>
<p>After you <a href="./install.html">Install Scalejs</a>, create a new scalejs project by selecting the template for a 
<strong>Scalejs MVVM Application (CSS)</strong> from the project creation window.</p>
<p><img src="./project1.png" alt="Scalejs MVVM Application is listed under &#39;Visual C#&#39; templates"></p>
<p><em>For this tutorial we will use the CSS template. LESS will be covered in another tutorial</em></p>
<p>Every Scalejs Project has a similar file structure (as seen below) 
which is explained in in depth <a href="./template.html">here</a>. 
Your application code, which we will be editing in this tutorial, is within the <em>app</em> folder. 
This folder contains the <a href="./architecture.html#modules">modules</a> for your project. 
A module contains <a href="./mvvm.html#bindings">bindings</a>, <a href="./mvvm.html#viewmodel">viewmodels</a>,
<a href="./styles.html">styles</a> and <a href="./mvvm.html#view">views</a>. </p>
<p><img src="./project2.png" alt="Files generated by project template"></p>
<p>To view and run the project, press <strong>ctrl + f5</strong>. Then open a browser with a <a href="./best.html#debug">debugging console</a> (press F12 to open)
and navigate to <a href="http://localhost:8888">http://localhost:8888</a> to see it in action!</p>
<p><img src="./helloworld.png" alt="Hello World!"></p>
<p><strong>For further changes to the app to work, make sure to disable caching in your browser!</strong></p>
<h3 id="designing-todomvc-application">Designing ToDoMVC Application</h3>
<p>The ToDo MVC application already has well defined <a href="https://github.com/tastejs/todomvc/blob/gh-pages/app-spec.md">specification and design guidelines</a>. 
Typically scalejs is used to create modular applications. Even though we do not need this for ToDoMVC
because it is so simple, we will show you to do it in a modular fashion.</p>
<p>A module is <em>self-contained, independent, and reusable</em> component of your web application. Modules are loosely-coupled
meaning they do not depend on other modules. Modules contain views, viewmodels, styles, and bindings, which we will 
go over in more detail as we create the app.</p>
<p>Typically scalejs apps consist of a <em>main</em> module and other functional modules. 
The main module is responsible for the overall application <a href="./layout.html">layout</a>, setting up <a href="./routing.html">routing</a>, and 
setting up the application <a href="./statechart.html">statechart</a>. It usually does not contain any business specific functionality. 
Functional modules are responsible for implementing business functionality.
An example of a functional module is the <em>todo</em> module.</p>
<p>In our ToDoMVC app, there are 2 modules: <em>main</em> and <em>todo</em>. Notice how <em>main</em> is the outer module, and consists
of the header and background, where as the <em>todo</em> module shows the todos and lets you interact with them.</p>
<p><img src="./todo.png" alt="ToDo App consists of two modules: main and todo"></p>
<h3 id="mvvm-concepts">MVVM Concepts</h3>
<p>Before we cover the rest of the tutorial, we will briefly discuss what MVVM is and how it is used in scalejs. 
MVVM stands for <strong>Model-View-ViewModel</strong>, which is an application design pattern used to enforce seperation of concerns.</p>
<p>In our scalejs app, each module has its <em>own</em> models, views and viewmodels..
A module consists of a <a href="./mvvm.html#views">view</a>, <a href="./mvvm.html#viewmodel">viewmodel</a>, 
<a href="./mvvm.html#bindings">bindings</a> and <a href="./mvvm.html#styles">styles</a>. Therefore, along with the javascript file
which will initialize a module, there are 4 additional folders within a module which contain the javascript files for the ViewModel
and the HTML and CSS files for the view. We also can define our bindings between the ViewModel and View in a seperate file.</p>
<p>The <strong>view</strong> defines templates for your modules. It is responsible for the visual representation of your module and is written in html.</p>
<p>The <strong>viewmodel</strong> performs logical tasks, and exposes properties to the view. 
These properties can be bound to the view in such a way that when a change is made in the viewmodel, 
it will automatically update the view. Also, the reverse would also work;
 if you made a change in the view (e.g. inputing a value into a textbox), it will update the corrosponding
viewmodel property. </p>
<p>The <strong>bindings</strong> define what is bound to an element with a certain data class. You can bind properties of the view model directly to 
HTML elements using <code>data-bind</code>, but for more complex bindings you can bind the element to a class name using <code>data-class</code>. 
This class must be defined in the bindings.</p>
<p>The <strong>styles</strong> contain the .css files which are needed for the module.</p>
<p>A Scalejs project generates modules which already include the view, viewmodel, bindings and styles.</p>
<p><br></p>
<h2 id="2-create-the-main-module">2. Create the Main Module</h2>
<p>The main module serves as a shell of our application. 
In this module, we define the layout and styles, but we do not define
the functional aspects of the application. 
Rather, we specify <strong>named regions</strong> in the html
which are merely be placeholders for content. Views from other modules can
appear in these placeholders. 
It can also define certain top-level UI elements, such as the background, main menu, or toolbar. </p>
<p>It defines the overall appearance of the application. 
It might define styles and borders that are present and visible in the shell layout itself, 
and it might also define styles, templates, and themes that will be applied to the views that 
are plugged into placeholders.</p>
<h3 id="main-view">Main View</h3>
<p>The <em>main</em> view defines the html for the layout and is located in in the <strong>views</strong> folder.</p>
<p>A <strong>template</strong> is a parentless div in an html file within your <em>views</em> folder that has an id with the postfix <code>_template</code>.
We only need to define one template for <em>main</em> which specifies the layout.</p>
<p><sub><strong>main/views/main.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todoapp"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">header</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>todos<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- we need to reference todo input here --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">header</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- we need to reference todo items here --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"info"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Double-click to edit a todo<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>Our layout defines two regions (items and input) that can become filled by
views within the <em>todo</em> module. We split it up this way
so that our <em>main</em> module also has control over the header &quot;todos&quot; and the <em>todo</em> module is soley responsible for
the funtionality of creating, showing, editing, and removing todos.</p>
<p><strong>In order to allow the todo module to render the views, the first thing we need to do is </strong>bind the view to the viewmodel__.
We use a <a href="http://knockoutjs.com/">knockoutjs</a> <a href="./mvvm.html#virtual">virtual binding</a> to create the regions in the layout. 
The binding which we are using is <a href="./mvvm.html#render">render</a>. </p>
<p>The reason we use a virtual binding is because we do not want to create a new html element; we just want to take 
the contents of the view and render them where virtual binding is declared. Had we used regular bindings,
which we will see in the next section, a new html element would need to be created as a wrapper for the
bound content. </p>
<p><sub><strong>main/views/main.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todoapp"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">header</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>todos<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
            !!*<span class="hljs-comment">&lt;!-- ko render:todoInput--&gt;</span>
            <span class="hljs-comment">&lt;!-- /ko --&gt;</span>**!
        <span class="hljs-tag">&lt;/<span class="hljs-title">header</span>&gt;</span>
        !!*<span class="hljs-comment">&lt;!-- ko render:todoItems --&gt;</span>
        <span class="hljs-comment">&lt;!-- /ko --&gt;</span>**!
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"info"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Double-click to edit a todo<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>We have created the view, however, if you were to run the app, you would see an error.</p>
<blockquote>
<p>Save the file, refresh the browser, and open the debugging console to see the following</p>
</blockquote>
<p><img src="./error1.png" alt="It doesn&#39;t work :("></p>
<p>We can fix this problem in the viewmodel.</p>
<h3 id="main-viewmodel">Main ViewModel</h3>
<p>For a brief moment, we will diverge from our tutorial in order to explain some important concepts which
will be used repeatedly within our JavaScript files.</p>
<p>The <a href="./mvvm.html#viewmodel">ViewModel</a> is a <a href="http://requirejs.org/">requirejs</a> module. Requirejs gives scalejs the ability to load modules with
the neccessary dependencies while also keeping the global namespace clean since everything defined within the module
is scoped to the function passed into <code>define</code>. Optionally, you can define an array of arguments to be passed
into the function which is called, and these can be references to other requirejs modules or scalejs components,
such as the sandbox (which can be seen in the below example.) The mainModule.js file and bindings file are also
requirejs modules. <em>Every JavaScript file within the app will most likely be a requirejs module.</em></p>
<p>Another thing in our modules, and more specifically ViewModels, which is of importance is the use of observables. 
Using scalejs requires an understanding
of the MVVM functionality which is provided by <a href="http://knockoutjs.com/">knockoutjs</a> so it is a good idea to get familiar
with knockout bindings. What you need to care about now is that observables provide automatic UI updating when they
are bound to an HTML element. This means that a change to this property will automatically refresh the corrosponding
UI component, without needing to explictly update the UI whenever it needs to be changed.</p>
<p>In order to use <code>observable</code> in our code, we import it from the <code>sandbox</code> by 
setting it to a var at the top of our module. The <code>sandbox</code> is where extensions can
place themselves and expose functions for modules to use. The <code>sandbox</code> allows  modules
to access these extensions in a sandboxed manner, so no module has access to another
module&#39;s sandbox.  <code>observable</code> is included in the <code>mvvm</code> extension. You can learn
more about the <a href="./architecture.html#sandbox">sandbox</a> and the <a href="./mvvm.html">mvvm extension</a>
in our docs. </p>
<p><img src="./intellisense1.png" alt="Magicall"></p>
<p>One of the great benefits to scalejs is that we have <a href="./best.html#intellisense">intellisense</a>
for all of extensions and functions in the sandbox. Keep a look out for what happens as 
you add functions from the sandbox to your app, and feel free to take a peek at what is 
exposed on the sandbox with the handy dandy intellisense.</p>
<p>Now back to the tutorial.</p>
<p>Since we have referenced <code>todoInput</code> and <code>todoItems</code> in the view, we have to define them in the viewmodel. 
Making the following change will fix the issues we just saw after altering the view.</p>
<p><sub><strong>main/viewmodels/mainViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!main'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> <span class="hljs-comment">// imports</span>
            observable = sandbox.mvvm.observable,
            <span class="hljs-comment">// properties</span>
            !!*todoItems = observable(),
            todoInput = observable();**!

        <span class="hljs-keyword">return</span> {
            !!*todoItems: todoItems,
            todoInput: todoInput**!
        };
    };
});
</code></pre>
<p>The view is bound to <code>todoItems</code> and <code>todoInput</code> which is why they must be <strong>returned from the viewmodel</strong>.
If we did not return them here, the view would not be able to access it - they would be <em>private</em> variables. 
It is best practice to only return variables that are needed in another file within the module (e.g. <em>public</em> variables). 
In this case, we need it in the view. We could also access these from
the module or another viewmodel. As you can now see, exposing these properties in the view resolved the issues from earlier.</p>
<p><img src="./mainvm1.png" alt="Main ViewModel is working"></p>
<h3 id="main-statechart">Main Statechart</h3>
<p>Render can be bound to a template and corrosponding data. We want to render content from the <em>todo</em> module, 
but in order for the <em>todo</em> module to update these observables, we need to expose it in the <a href="./statechart.html">statechart</a>. </p>
<p>The statechart defines the states and flow of your application. The statechart consists of two things: states and transitions. When we transition to a state, we setup the
state within the <code>onEntry</code> transition. We also can listen for events (which are called with <code>raise</code>) and
transition to the appropriate state based upon that. A benefit of the statechart is that states can be hierachical and can also run in parallel to eachother. 
For example, our router is a parallel state and we will discuss <a href="./routing.html">routing</a> later on.
The statechart is better understood in practice, but you can familiarize yourself with the statechart from
the <a href="./statechart.html">statechart documentation</a></p>
<p>In order to preserve loose-coupling, the statechart must allow modules to be agnostic to each other, 
so that the <em>main</em> module does not need to know any details about the <em>todo</em> module or vice versa. 
The modules will, however, be concerned with the statechart as it defines the flow of the application. </p>
<p>In this situation, we would like to define <code>todoItems</code> and <code>todoInput</code> on the statechart so that the <em>todo</em>
module can access them. The statechart context is shared between all states in all the modules. 
If used properly, this what allows modules to affect one another while still being loosely coupled.</p>
<p>Adding properties to the statechart is very simple; the context of the statechart is exposed via <code>this</code> 
within the functions of the statechart (i.e. <code>onEntry</code>). </p>
<p><sub><strong>main/mainModule.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!main'</span>,
    <span class="hljs-string">'app/main/viewmodels/mainViewModel'</span>,
    <span class="hljs-string">'views!main'</span>,
    <span class="hljs-string">'bindings!main'</span>,
    <span class="hljs-string">'styles!main'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    mainViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> <span class="hljs-comment">// imports</span>
            root = sandbox.mvvm.root,
            template = sandbox.mvvm.template,
            registerStates = sandbox.state.registerStates,
            state = sandbox.state.builder.state,
            onEntry = sandbox.state.builder.onEntry,
            <span class="hljs-comment">// vars</span>
            !!*mainVM = mainViewModel();**!

        <span class="hljs-comment">// Register application state for the module.</span>
        registerStates(<span class="hljs-string">'root'</span>,
            state(<span class="hljs-string">'app'</span>,
                state(<span class="hljs-string">'main'</span>,
                    onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        !!*<span class="hljs-comment">// create state properties for rendering todo module templates</span>
                        <span class="hljs-keyword">this</span>.todoItems = mainVM.todoItems;
                        <span class="hljs-keyword">this</span>.todoInput = mainVM.todoInput;**!
                        <span class="hljs-comment">// Render viewModel using 'main_template' template </span>
                        <span class="hljs-comment">// (defined in main.html) and show it in the `root` region.</span>
                        !!*root(template(<span class="hljs-string">'main_template'</span>, mainVM));**!
                    }))));
    };
});
</code></pre>
<p><em>Note: We renamed</em> <code>viewModel</code> <em>to</em> <code>mainVM</code> <em>to avoid ambiguity</em></p>
<p>Recall that when we created the <code>todoItems</code> and <code>todoInput</code> properties, we assign them to an empty observable. 
These observables can now be accessed and updated by another module, but <em>main</em> doesn&#39;t know anything about this 
other module which preserves the pattern of loosely-coupled modules. Even though the <em>todo</em> module passes
its content to these observables, it doesn&#39;t know anything about the <em>main</em> module other
than what is explictly shared via state.</p>
<p>You will find that all of the errors are gone, but unfortunately it is not styled. However,
functionally we are done with the <em>main</em> module.</p>
<p><img src="./app1.png" alt="Main module sans styles"></p>
<h3 id="main-bindings">Main Bindings</h3>
<p>We did not need to declare bindings because we used <code>data-bind</code>, 
but we will be using <code>data-class</code> in some instances within the <em>todo</em> module so that is when we will be creating
bindings.</p>
<h3 id="main-styles">Main Styles</h3>
<p>Styling main is simple and straight-forward. We used the <a href="https://github.com/tastejs/todomvc/blob/gh-pages/template/bower_components/todomvc-common/base.css">css</a> that was provided by the <a href="http://todomvc.com/">todomvc</a>
specification. We will just copy-and-paste the contents of this css file into <strong>main.css</strong> which is located in the
<strong>styles</strong> folder. In a future tutorial, we will cover how to use LESS in your modules.</p>
<p><img src="./app2.png" alt="Main module with styles"></p>
<p><br></p>
<h2 id="3-create-the-todo-module">3. Create the todo Module</h2>
<p>The todo module is responsible for the functionality needed in the todo list, such as adding, editing, and removing todos.
Making a new module is extremely easy because scalejs provides Visual Stuido Item Templates
for modules. <strong>Right-click</strong> on the <strong>app</strong> folder and select <strong>Add &gt; New Item.</strong>
From the Add New Item window, search for <em>scalejs</em> and select the 
<strong>Scalejs MVVM Module (CSS)</strong>. Name this module <em>todo</em> and click <strong>Add</strong>.</p>
<p><img src="./module1.png" alt="Creating a new Module"></p>
<p>Once we create a module we need include it in the <strong>app.js</strong> file by appending a comma and the name of the module
to the <code>scalejs!application</code> argument within the <code>require</code> function.</p>
<p><sub><strong>app.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-built_in">require</span>([
    <span class="hljs-string">'scalejs!application/main!!*,todo**!'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    application
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    application.run();
});
</code></pre>
<p>This will not allow the todo module to work as intended as <strong>todoModule.js</strong> is generated by the item template, 
but it needs to be modified slightly so that we are adding the todo state to the correct parent state.
Below is the todoModule.js file which is created by the module template.</p>
<p><sub><strong>todo/todoModule.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/todoViewModel'</span>,
    <span class="hljs-string">'bindings!todo'</span>,
    <span class="hljs-string">'views!todo'</span>,
    <span class="hljs-string">'styles!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    todoViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">todoModule</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> <span class="hljs-comment">// imports</span>
            root = sandbox.mvvm.root,
            template = sandbox.mvvm.template,
            registerStates = sandbox.state.registerStates,
            state = sandbox.state.builder.state,
            onEntry = sandbox.state.builder.onEntry,
            <span class="hljs-comment">// vars</span>
            todo = todoViewModel(sandbox);

        <span class="hljs-comment">// Register application state for the module.</span>
        registerStates(<span class="hljs-string">'app'</span>,
            state(<span class="hljs-string">'todo'</span>,
                onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-comment">// Render viewModel using 'main_template' template </span>
                    <span class="hljs-comment">// (defined in main.html) and show it in the `root` region.</span>
                    todo.text(<span class="hljs-string">'Hello World from todo!'</span>);
                    root(template(<span class="hljs-string">'todo_template'</span>, todo));
                })));
    };
});
</code></pre>
<p>As you can see above, the <em>todo</em> state is defined as a child to the <em>app</em> state. 
Since the <em>main</em> state is also a child of the <em>app</em> state,
the app can only be in either the <em>main</em> state or the <em>todo</em> state at a time. 
This means that our statechart looks like this:</p>
<p><img src="./statechart1.png" alt="Bad statechart"></p>
<p>To remedy this, we can make <em>todo</em> a child of the <em>main</em> state by changing the statechart in <strong>todoModule.js</strong>.</p>
<p><sub><strong>todo/todoModule.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/todoViewModel'</span>,
    <span class="hljs-string">'bindings!todo'</span>,
    <span class="hljs-string">'views!todo'</span>,
    <span class="hljs-string">'styles!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    todoViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">todoModule</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> <span class="hljs-comment">// imports</span>
            root = sandbox.mvvm.root,
            template = sandbox.mvvm.template,
            registerStates = sandbox.state.registerStates,
            state = sandbox.state.builder.state,
            onEntry = sandbox.state.builder.onEntry,
            <span class="hljs-comment">// vars</span>
            todo = todoViewModel(sandbox);

        <span class="hljs-comment">// Register application state for the module.</span>
        !!*registerStates(<span class="hljs-string">'main'</span>,**!
            state(<span class="hljs-string">'todo'</span>,
                onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-comment">// Render viewModel using 'main_template' template </span>
                    <span class="hljs-comment">// (defined in main.html) and show it in the `root` region.</span>
                    todo.text(<span class="hljs-string">'Hello World from todo!'</span>);
                    root(template(<span class="hljs-string">'todo_template'</span>, todo));
                })));
    };
});
</code></pre>
<p>Now we have created this statechart:</p>
<p><img src="./statechart2.png" alt="Good Statechart"></p>
<h3 id="todo-view">Todo View</h3>
<p>While <em>main</em> view was responsible for the overall app layout, <em>todo</em> is responsible for two views: one for the 
todo list, and the other for the todo input.</p>
<p>The template for the list is a little more complex than the
one for main. For now, we won&#39;t add any bindings; we will do that as we add functionality.</p>
<p>For now all we need to do is define the template so they can be rendered in the <code>todoItems</code> and <code>todoInput</code> regions defined in the <em>main</em> view above.</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- These are here just to show the structure of the list items --&gt;</span>
            <span class="hljs-comment">&lt;!-- List items should get the class `editing` when editing and `completed` when marked as completed --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"completed"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">checked</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span>&gt;</span>Create a TodoMVC template<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Create a TodoMVC template"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span>&gt;</span>Rule the web<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Rule the web"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- This footer should hidden by default and shown when there are todos --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- This should be `0 items left` by default --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">strong</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span> item left<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Hidden if no completed items are left --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span>&gt;</span>Clear completed (1)<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>In the boilerplate code for the <em>todo</em> state we are passing the template (which no longer have defined within our view) to the
<code>root</code> which is wrong. It will cause the whole root element to be rendered to that view.
 Instead we should be passing the <code>todo_items_template</code> and the <code>todo_input_template</code> 
into the <code>todoItems</code> and <code>todoInput</code> observables we defined in the <em>main</em> state.</p>
<p><sub><strong>todo/todoModule.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/todoViewModel'</span>,
    <span class="hljs-string">'bindings!todo'</span>,
    <span class="hljs-string">'views!todo'</span>,
    <span class="hljs-string">'styles!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    todoViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">todoModule</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> <span class="hljs-comment">// imports</span>
            root = sandbox.mvvm.root,
            template = sandbox.mvvm.template,
            registerStates = sandbox.state.registerStates,
            state = sandbox.state.builder.state,
            onEntry = sandbox.state.builder.onEntry,
            <span class="hljs-comment">// vars</span>
            todo = todoViewModel(sandbox);

        <span class="hljs-comment">// Register application state for the module.</span>
        registerStates(<span class="hljs-string">'main'</span>,
            state(<span class="hljs-string">'todo'</span>,
                onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    !!*<span class="hljs-comment">// pass the template bindings to the appropriate property</span>
                    <span class="hljs-keyword">this</span>.todoItems(template(<span class="hljs-string">'todo_items_template'</span>, todo));
                    <span class="hljs-keyword">this</span>.todoInput(template(<span class="hljs-string">'todo_input_template'</span>, todo));**!
                })));
    };
});
</code></pre>
<p>This is all you need to display the <em>todo</em> module in your app. Now if you refresh
your browser you will see a static version of the <em>todo</em> module. </p>
<p><img src="./todo1.png" alt="A Useless Web App!"></p>
<p><br></p>
<h2 id="functionality">Functionality</h2>
<p>The static app might look good, but as you can tell by clicking on it is completely
useless. We can fix this by adding functionality which we will do in incremental
steps so that you are able to follow along.</p>
<p><br></p>
<h3 id="4-hide-main-and-footer-when-there-are-none">4. Hide main and footer when there are none</h3>
<p>According to the spec, the element with the id <code>#main</code> and the element with the id <code>#footer</code>
must be hidden when there are no todos. To do this we need to have a data structure
to store the todos. We need to be able to know how many items are in this structure.
We also need to be able to add and remove items. Since we will be showing todos in our 
view, the view must be able to react to the changes in the structure.</p>
<p>To accomplish all of this we use an <code>observableArray</code> to store the items. 
Like with <code>observables</code>, if you are familiar with knockout.js this should be easy to do, but if not you can
learn about them in more detail <a href="./mvvm.html#obseravles">here</a> and also on <a href="http://knockoutjs.com/documentation/observables.html">knockout&#39;s website</a>.
Since this is a requirement for the functionality of the <em>todo</em> module it must be declared in the ViewModel.</p>
<p><sub><strong>todo/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        !!*<span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            <span class="hljs-comment">//properties</span>
            items = observableArray();**!

        <span class="hljs-keyword">return</span> {
            !!*items: items**!
        };
    };
});
</code></pre>
<p>We need to hide <code>#main</code> and <code>#footer</code> if this array is empty. 
We can do this by defining a special data-class. 
To add a data-class to an element in your template is very simple and straightforward. 
We will add the data-class <code>todo-visible</code> in the <code>todo_items_template</code>.</p>
<p><sub><strong>todo/views/todo.html</strong><sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    !!*<span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>**!
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- These are here just to show the structure of the list items --&gt;</span>
            <span class="hljs-comment">&lt;!-- List items should get the class `editing` when editing and `completed` when marked as completed --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"completed"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">checked</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span>&gt;</span>Create a TodoMVC template<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Create a TodoMVC template"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span>&gt;</span>Rule the web<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Rule the web"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    !!*<span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>**!
        <span class="hljs-comment">&lt;!-- This should be `0 items left` by default --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">strong</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span> item left<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Hidden if no completed items are left --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span>&gt;</span>Clear completed (1)<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>The reason we use data-class instead of data-bind is so that we do not have to include complicated
JavaScript within the html of our app. We can define the data-class in our bindings file.</p>
<p>Now we can define the logic behind the <code>todo-visible</code> data-class in <strong>todoBindings.js</strong>.</p>
<p><sub><strong>todo/bindings/todoBindings.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
<span class="hljs-comment">/*jslint sloppy: true*/</span>
define({
    !!*<span class="hljs-string">'todo-visible'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> {
            visible: <span class="hljs-keyword">this</span>.items().length &gt; <span class="hljs-number">0</span>
        };
    }**!
});
</code></pre>
<p>After saving these files, refresh the browsers to observe the appropriate divs being hidden.</p>
<p><img src="./todohidden.png" alt="Nothing to do!"></p>
<p><br></p>
<h3 id="5-adding-a-new-todo">5. Adding a new todo</h3>
<p>We need to let the user input a todo and when they hit enter it needs to be added to the list.
For this functionality, we need to bind the input to a new property of the viewmodel which will be implemented
using an observable. Let&#39;s call it <code>newItem</code>.</p>
<p><sub><strong>todo/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> !!*observable = sandbox.mvvm.observable,**!
            observableArray = sandbox.mvvm.observableArray,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            !!*newItem = observable();**!

        <span class="hljs-keyword">return</span> {
            items: items,
            !!*newItem: newItem**!
        };
    };
});
</code></pre>
<p><code>newItem</code> must be bound to the <em>value</em> binding of the input box so that as the user types,
the observale gets updated with what they type. We also need to instruct this observable
to update whenever a user hits a key (<code>afterkeydown</code> event) and to listen for the
<code>ENTER_KEY</code> so that the <code>newItem</code>  can be added to the <code>items</code> array.</p>
<p>Because we need to do so much with this input, we will assign a  data-class 
to it and name the data-class <code>todo-input</code>. This time, we are using a data-class because
there are so many bindings on this element and it will be cleaner to define
them outside of the html.</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- These are here just to show the structure of the list items --&gt;</span>
            <span class="hljs-comment">&lt;!-- List items should get the class `editing` when editing and `completed` when marked as completed --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"completed"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">checked</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span>&gt;</span>Create a TodoMVC template<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Create a TodoMVC template"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span>&gt;</span>Rule the web<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Rule the web"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- This should be `0 items left` by default --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">strong</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span> item left<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Hidden if no completed items are left --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span>&gt;</span>Clear completed (1)<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    !!*<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>**!
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>Similarly to <code>todo-visible</code>, we must add a definition for this class in <strong>todoBindings.js</strong></p>
<p><sub><strong>todo/bindings/todoBindings.html</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
<span class="hljs-comment">/*jslint sloppy: true*/</span>
define({
    <span class="hljs-string">'todo-visible'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> {
            visible: <span class="hljs-keyword">this</span>.items().length &gt; <span class="hljs-number">0</span>
        };
    !!*},
    <span class="hljs-string">'todo-input'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> {
            value: <span class="hljs-keyword">this</span>.newItem,
            valueUpdate: <span class="hljs-string">'afterkeydown'</span>
        };**!
    }
});
</code></pre>
<p>With these bindings, we are listening for user input and updating <code>newItem</code> whenever
the user presses a key.</p>
<p>You might be wondering a few things about how <a href="./mvvm.html#bindings">bindings</a> work.
<code>this</code> contains a reference to the viewmodel within the context of this binding.
Usually this is the viewmodel for the module, but in some cases (such as the foreach binding)
it will be something else. We will explain this in more detail when we implement
displaying the todos in a list.</p>
<p>Also, we are prefixing all of our data-class names with the name of the module 
(e.g. <em>todo-</em>) because we want to make it cleaner for a developer to know what module a 
data-class belongs to by looking at its class name.</p>
<p>Now we need to add the logic so that when one presses enter a new todo is added to the list. 
First lets create a function in <strong>todoViewModel.js</strong> to do so. We will call it <code>addItem</code>.</p>
<p><sub><strong>todo/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observable = sandbox.mvvm.observable,
            observableArray = sandbox.mvvm.observableArray,
            !!*has = sandbox.object.has,**!
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable();

        !!*<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push(item.trim());
            }
            newItem(<span class="hljs-string">""</span>);
        }**!

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            !!*addItem: addItem**!
        };
    };
});
</code></pre>
<p>In <code>addItem</code> we use the <a href="./api.html#has">has</a> function so
be sure to include it from the sandbox. <code>has</code> can be found in the <code>object</code> namespace and we
use it to make sure that the item has the <code>trim</code> function before we attempt to call it.</p>
<p>The next step is making sure this function gets called when the user hits enter. We can do that by defining an
event binding in the <code>todo-input</code> data-class we defined from before.</p>
<p><sub><strong>todo/bindings/todoBindings.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
<span class="hljs-comment">/*jslint sloppy: true,unparam: true*/</span>
!!*define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> ENTER_KEY = <span class="hljs-number">13</span>;
    <span class="hljs-keyword">return</span> {**!
        <span class="hljs-string">'todo-visible'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                visible: <span class="hljs-keyword">this</span>.items().length &gt; <span class="hljs-number">0</span>
            };
        },
        !!*<span class="hljs-string">'todo-input'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> addItem = <span class="hljs-keyword">this</span>.addItem;
            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.newItem,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            addItem();
                        }
                    }
                }
            };
        }
    };**!
});
</code></pre>
<p>Since we defined a function for the event, we lost the context of the outer function so we 
cannot use <code>this</code> to get our viewModel properties. To fix this we define a var at the top of the data-class
with the same name as the function 
we want to use (<code>addItem</code>) and assigned the function defined in <code>this</code> to the var.</p>
<p>We also converted our bindings object to a function which will return the bindings object, so that we can define
&#39;global&#39; vars (which are local to the function containing the bindings) which will let us reuse constants like <code>ENTER_KEY</code>
in our bindings. We will need it again for editing an item, so it&#39;s good to do this now.</p>
<p>If you refresh the page now and try adding an item, you will see that entering
an item and will clear the input and show some todos, but since we haven&#39;t
implemented showing todos it won&#39;t actually display the todo you just entered.</p>
<p><br></p>
<h3 id="6-displaying-todos-in-the-list">6. Displaying todos in the list</h3>
<p>We need to make sure the todos are being displayed in the list.
Right now we&#39;re not binding the list to anything - but the fix is very simple. 
We can bind the <code>ul</code> element to the items array using the <code>foreach</code> binding. The contents
of the <code>ul</code> will be repeated for each item in the list, with the item providing the 
context for the binding.</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        !!*<span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: items"</span>&gt;</span>**!
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"completed"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">checked</span>&gt;</span>
                    !!*<span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: $data"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>**!
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Create a TodoMVC template"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- This should be `0 items left` by default --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">strong</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span> item left<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Hidden if no completed items are left --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span>&gt;</span>Clear completed (1)<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>Instead of using a data-class we just used a <code>data-bind</code> attribute like we did in the <code>main_template</code> with <code>render</code>. 
<code>foreach</code> is a knockout binding which will take the contents of the div and render it as a template for each
item within the array <code>foreach</code> is bound to. You can learn more about it <a href="http://knockoutjs.com/documentation/foreach-binding.html">here</a></p>
<p>After saving these files, refresh the browser to observe the ability to add items to the list.</p>
<p><img src="./todo3.png" alt="Adding items to the list"></p>
<p>But this isn&#39;t enough. We also need to do a little extra work when adding an item so that it shows 
as completed only when it is completed. To do this, we need to alter the item so
it is an object with two properties: <code>title</code> and <code>completed</code>.. 
In <strong>todoViewModel.js</strong> make the following change to the item when it is pushed to the items array.</p>
<p><sub><strong>todo/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observable = sandbox.mvvm.observable,
            observableArray = sandbox.mvvm.observableArray,
            has = sandbox.object.has,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable();

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                !!*items.push({
                    title: item.trim(),
                    completed: observable(<span class="hljs-literal">false</span>)
                });**!
            }
            newItem(<span class="hljs-string">""</span>);
        }

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem
        };
    };
});
</code></pre>
<p>In <code>todo_items_template</code> also edit the li element so that it is being bound to the title
and the completed properties.</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: items"</span>&gt;</span>
            !!*<span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"css: { completed: completed }"</span>&gt;</span>**!
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    !!*<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: completed"</span>&gt;</span>**!
                    !!*<span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>**!
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Create a TodoMVC template"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- This should be `0 items left` by default --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">strong</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span> item left<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Hidden if no completed items are left --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span>&gt;</span>Clear completed (1)<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>Now the completed class is only added if the item&#39;s <code>completed</code>
property is true. At the same time, we are also able to toggle this class on and off when we check or uncheck 
the item because we have bound the checkbox input to the <code>checked</code> binding. Since <code>completed</code> is an observable, 
when we check the item, <code>completed</code> becomes true, so the css completed is applied to the list item.</p>
<p>After saving these files, refresh the browsers to observe that checking/unchecking the checkbox applies the 
appropriate class to the list item.</p>
<p><img src="./todo2.png" alt="Now we can add items to the todo list"></p>
<p><br></p>
<h3 id="7-mark-all-as-complete">7. Mark all as complete</h3>
<p>We need to mark all of the items as completed when we click on the arrow
to the left of the input box. We use a <code>computed</code> property to do this. Computed properties
are more complex than observables but are very useful once you understand them.
You can read more about computed properties <a href="http://knockoutjs.com/documentation/computedObservables.html">here</a>. </p>
<p>The computed will re-evaluate any time an observable within it changes. 
We can use this to react to the <code>items</code> and return true when they are all checked
to indicate to the &#39;mark all as complete&#39; arrow that it should be &#39;checked&#39;</p>
<p><sub><strong>todo/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            !!*computed = sandbox.mvvm.computed,**!
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            !!*checkAll;**!

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push({
                    title: item.trim(),
                    completed: observable(<span class="hljs-literal">false</span>)
                });
            }
            newItem(<span class="hljs-string">""</span>);
        }

        !!*checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            }
        });**!

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            !!*checkAll: checkAll**!
        };
    };
});
</code></pre>
<p>An interesting thing to note about our implementation of the <code>read</code> function is that we
are using the <code>all</code> function which we get from <a href="http://linqjs.codeplex.com/">linq.js</a>. In JavaScript apps you need to
manipulate arrays/lists/collections quite
often and therefore need more sophisticated functionality than what is provided by JavaScript.
This is why we expose all of linq&#39;s functions on the Array&#39;s prototype. </p>
<p>We bind the computed property to the <code>toggle-all</code> checkbox like so:</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        !!*<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: checkAll"</span>&gt;</span>**!
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: items"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"css: { completed: completed }"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: completed"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Create a TodoMVC template"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- This should be `0 items left` by default --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">strong</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span> item left<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Hidden if no completed items are left --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span>&gt;</span>Clear completed (1)<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>Now if you add a new item then mark it as complete, you will see the toggle-all 
checkbox is darker (e.g. it is checked). This checkbox will be checked if and
only if all the items in the list are checked. But if you click on this checkbox,
you are not able to change its value or update the items to be marked as completed
or not completed. We can fix this by giving this computed property a <code>write</code> function
which will take whatever value it is given and apply it to all the items&#39; <code>completed</code> 
properties.</p>
<p><sub><strong>todo/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push({
                    title: item.trim(),
                    completed: observable(<span class="hljs-literal">false</span>)
                });
            }
            newItem(<span class="hljs-string">""</span>);
        }

        !!*checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });**!

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll
        };
    };
});
</code></pre>
<p>Now your app can mark/unmark all items as completed. Save and refresh to see it
in action.</p>
<p><br></p>
<h3 id="8-editing-a-todo">8. Editing a todo</h3>
<p>For this functionality we need to modify the <code>li</code> element a bit. We need to define a new
data-class for the element because we need to add more bindings and having any more than
one or two bindings on an html element looks ugly. We will give it the <code>todo-item</code> data-class.</p>
<p>We also need to add a data-class to the input element so that we can toggle editing on
and off. We will call this the <code>todo-edit</code> class.</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: checkAll"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: items"</span>&gt;</span>
            !!*<span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-item"</span>&gt;</span>**!
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: completed"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                !!*<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-edit"</span> /&gt;</span>**!
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- This should be `0 items left` by default --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">strong</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span> item left<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Hidden if no completed items are left --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span>&gt;</span>Clear completed (1)<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>In the <code>todo-item</code> data-class, not only do we need to repeat the binding we had previously
defined inline in the html, we also need to apply an <code>editing</code> class if the item is being 
edited. We begin editing an item when we double-click on an item, so we also bind a function 
called <code>beginEdit</code> to this event.</p>
<p><sub><strong>todo/bindings/todoBindings.html</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
<span class="hljs-comment">/*jslint sloppy: true,unparam: true*/</span>
define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> ENTER_KEY = <span class="hljs-number">13</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'todo-visible'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                visible: <span class="hljs-keyword">this</span>.items().length &gt; <span class="hljs-number">0</span>
            };
        },
        <span class="hljs-string">'todo-input'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> addItem = <span class="hljs-keyword">this</span>.addItem;
            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.newItem,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            addItem();
                        }
                    }
                }
            };
        },
        !!*<span class="hljs-string">'todo-item'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                css: {
                    completed: <span class="hljs-keyword">this</span>.completed,
                    editing: <span class="hljs-keyword">this</span>.editMode
                },
                event: {
                    dblclick: <span class="hljs-keyword">this</span>.beginEdit
                }
            };
        }**!
    };
});
</code></pre>
<p>Since the <code>li</code> element is bound to an item, this means we have created two new properties
which need to be exposed on an item: <code>editMode</code> which is a boolean indicating if the item
is currently being editted, and <code>beginEdit</code> which is a function which will begin editing
on the item</p>
<p>The introduction of these two new properties on the item means that the item is getting
more and more complex. We also will need to add more properties and methods as we continue
to implement functionality, so the wise thing to do is to move the item to its own viewmodel in a separate file.</p>
<p>We will define a new viewmodel in the <strong>viewmodels</strong> folder for <em>todo</em> and name it <strong>itemViewModel.js</strong>.</p>
<p><img src="./newitem.png" alt="new item"></p>
<p>Copy and paste the code below or follow the pattern that the <em>main</em> and <em>todo</em> viewmodels use,
except do not declare any properties or return anything.</p>
<p><strong>todo/viewmodels/itemViewModel.js</strong></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

        <span class="hljs-keyword">return</span> {

        };
    };
});
</code></pre>
<p>We will reference this viewmodel from the <strong>todoViewModel</strong> when we make a new item. 
We need to pass to this viewmodel the title of the item and the status of its
completion (when we create an item, it will always be false - but making
this a parameter will come in handy when we implement persistance)</p>
<p><sub><strong>todo/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>!!*,
    <span class="hljs-string">'app/todo/viewmodels/itemViewModel'</span>**!
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox!!*,
    itemViewModel**!
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                !!*items.push(itemViewModel({ title: item, completed: <span class="hljs-literal">false</span> }));**!
            }
            newItem(<span class="hljs-string">""</span>);
        }

        checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll
        };
    };
});
</code></pre>
<p>Now we can recreate the functionality from before, and also add the new properties <code>editMode</code> and <code>beginEdit</code></p>
<p><sub><strong>todo/viewmodels/itemViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    !!*<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>**!
        !!*<span class="hljs-keyword">var</span> observable = sandbox.mvvm.observable,
            <span class="hljs-comment">//properties</span>
            title = observable(item.title),
            completed = observable(item.completed),
            editMode = observable(<span class="hljs-literal">false</span>);**!

        !!*<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beginEdit</span><span class="hljs-params">()</span> {</span>
            editMode(<span class="hljs-literal">true</span>);
        }**!

        <span class="hljs-keyword">return</span> {
            !!*title: title,
            completed: completed,
            editMode: editMode,
            beginEdit: beginEdit**!
        };
    };
});
</code></pre>
<p>This time, we made <code>title</code> an observable because when we are editing an item, presumably
we will need to change its title. <code>beginEdit</code> simply sets the <code>editMode</code> observable to true.</p>
<p>Beginning an edit is rather useless if we are unable to end it. To do this, we now will 
define the data-class <code>todo-edit</code> to listen for user input, update the value of title, and
end edit mode.</p>
<p><sub><strong>todo/bindings/todoBindings.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
<span class="hljs-comment">/*jslint sloppy: true,unparam: true*/</span>
define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> ENTER_KEY = <span class="hljs-number">13</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'todo-visible'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                visible: <span class="hljs-keyword">this</span>.items().length &gt; <span class="hljs-number">0</span>
            };
        },
        <span class="hljs-string">'todo-input'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> addItem = <span class="hljs-keyword">this</span>.addItem;
            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.newItem,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            addItem();
                        }
                    }
                }
            };
        },
        <span class="hljs-string">'todo-item'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                css: {
                    completed: <span class="hljs-keyword">this</span>.completed,
                    editing: <span class="hljs-keyword">this</span>.editMode
                },
                event: {
                    dblclick: <span class="hljs-keyword">this</span>.beginEdit
                }
            };
        },
        !!*<span class="hljs-string">'todo-edit'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">this</span>;

            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.title,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            item.endEdit();
                        }
                    },
                    blur: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        item.endEdit();
                    }
                },
                hasFocus: <span class="hljs-keyword">this</span>.editMode
            };
        }**!
    };
});
</code></pre>
<p><code>value</code> and <code>valueUpdate</code> should be ring a bell. <code>hasFocus</code> is bound to the <code>editMode</code> property
so that when <code>editMode</code> is entered, the input automatically is given focus. Also, on the blur event,
we make sure to call <code>item.endEdit()</code> so that it also ends the edit on blur. <code>endEdit</code> still
needs to be defined in order for this to come full-circle.</p>
<p><sub><strong>todo/viewmodels/itemViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>
        <span class="hljs-keyword">var</span> observable = sandbox.mvvm.observable,
            <span class="hljs-comment">//properties</span>
            title = observable(item.title),
            completed = observable(item.completed),
            editMode = observable(<span class="hljs-literal">false</span>);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beginEdit</span><span class="hljs-params">()</span> {</span>
            editMode(<span class="hljs-literal">true</span>);
        }

        !!*<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">endEdit</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> newTitle = title().trim();
            <span class="hljs-keyword">if</span> (newTitle) {
                title(newTitle);
                editMode(<span class="hljs-literal">false</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//we need to remove the item</span>
                <span class="hljs-comment">//if the title is an empty string</span>
            }
        }**!

        <span class="hljs-keyword">return</span> {
            title: title,
            completed: completed,
            editMode: editMode,
            beginEdit: beginEdit,
            !!*endEdit: endEdit**!
        };
    };
});
</code></pre>
<p>Now you can edit an item by double clicking on it, entering a new title, and hitting &#39;enter&#39;. </p>
<p><br></p>
<h3 id="9-removing-an-item">9. Removing an item</h3>
<p>An item can be removed in two ways: by clicking on the &#39;x&#39; that appears when you move the mouse over it, or
by changing the item to an empty string</p>
<p>An <code>observableArray</code> has a method, <code>remove</code>, which can remove an item from the array if it is passed
a reference to the item. We can use this function to remove our items by calling  <code>items.remove(item)</code>. </p>
<p>We will give the itemViewModel its own <code>remove</code> function which will, in turn, call <code>items.remove(this)</code>.
However the itemViewModel does not have <code>items</code> so we must pass the <code>items</code> to the <code>itemViewModel</code> so
we can access the remove function.</p>
<p><sub><strong>todo/viewmodels/itemViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item!!*, items**!)</span> {</span>
        <span class="hljs-keyword">var</span> observable = sandbox.mvvm.observable,
            <span class="hljs-comment">//properties</span>
            title = observable(item.title),
            completed = observable(item.completed),
            editMode = observable(<span class="hljs-literal">false</span>);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beginEdit</span><span class="hljs-params">()</span> {</span>
            editMode(<span class="hljs-literal">true</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">endEdit</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> newTitle = title().trim();
            <span class="hljs-keyword">if</span> (newTitle) {
                title(newTitle);
                editMode(<span class="hljs-literal">false</span>);
            } <span class="hljs-keyword">else</span> {
                items.remove(<span class="hljs-keyword">this</span>);
            }
        }

        !!*<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span> {</span>
            items.remove(<span class="hljs-keyword">this</span>);
        }**!

        <span class="hljs-keyword">return</span> {
            title: title,
            completed: completed,
            editMode: editMode,
            beginEdit: beginEdit,
            endEdit: endEdit!!*,
            remove: remove**!
        };
    };
});
</code></pre>
<p>Now we also need to modify the <strong>todoViewModel</strong> so that we are passing the items to the viewmodel.</p>
<p><sub><strong>todo/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/itemViewModel'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    itemViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push(itemViewModel({ title: item, completed: <span class="hljs-literal">false</span> }!!*, items**!));
            }
            newItem(<span class="hljs-string">""</span>);
        }

        checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll
        };
    };
});
</code></pre>
<p>Now all we need to do is bind the &#39;x&#39; button in the view to this function</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: checkAll"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: items"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: completed"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    !!*<span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"click: remove"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>**!
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-edit"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- This should be `0 items left` by default --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">strong</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span> item left<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Hidden if no completed items are left --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span>&gt;</span>Clear completed (1)<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>When the <code>remove</code> function is called, it will have the item passed to it (this is default behavior),
so it will work as expected. Refresh the page and try to remove an item if you do not believe me. 
Do this by clicking on the x, or editing an item and making it an empty string.</p>
<p><br></p>
<h3 id="10-cancel-edit-on-escape">10. Cancel edit on escape</h3>
<p>We also need to cancel the edit if the user hits &#39;escape&#39;. To do this we introduce a private variable
in our itemViewModel which stores the current title when an edit begins. We also need to implement
a <code>cancelEdit</code> function which will restore the previous title.</p>
<p><sub><strong>todo/viewmodels/itemViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item, items)</span> {</span>
        <span class="hljs-keyword">var</span> observable = sandbox.mvvm.observable,
            <span class="hljs-comment">//properties</span>
            title = observable(item.title),
            completed = observable(item.completed),
            editMode = observable(<span class="hljs-literal">false</span>),
             !!*previousTitle;**!

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beginEdit</span><span class="hljs-params">()</span> {</span>
            !!*previousTitle = <span class="hljs-keyword">this</span>.title();**!
            editMode(<span class="hljs-literal">true</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">endEdit</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> newTitle = title().trim();
            <span class="hljs-keyword">if</span> (newTitle) {
                title(newTitle);
                editMode(<span class="hljs-literal">false</span>);
            } <span class="hljs-keyword">else</span> {
                items.remove(<span class="hljs-keyword">this</span>);
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span> {</span>
            items.remove(<span class="hljs-keyword">this</span>);
        }

        !!*<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancelEdit</span><span class="hljs-params">()</span> {</span>
            title(previousTitle);
            editMode(<span class="hljs-literal">false</span>);
        }**!

        <span class="hljs-keyword">return</span> {
            title: title,
            completed: completed,
            editMode: editMode,
            beginEdit: beginEdit,
            endEdit: endEdit,
            remove: remove!!*,
            cancelEdit: cancelEdit**!
        };
    };
});
</code></pre>
<p>Also we have to modify the binding to call &#39;cancelEdit&#39; if the user presses the <code>ESCAPE_KEY</code></p>
<p><sub><strong>todo/viewmodels/todoBindings.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
<span class="hljs-comment">/*jslint sloppy: true,unparam: true*/</span>
define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> ENTER_KEY = <span class="hljs-number">13</span>!!*,
        ESCAPE_KEY = <span class="hljs-number">27</span>;**!

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'todo-visible'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                visible: <span class="hljs-keyword">this</span>.items().length &gt; <span class="hljs-number">0</span>
            };
        },
        <span class="hljs-string">'todo-input'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> addItem = <span class="hljs-keyword">this</span>.addItem;
            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.newItem,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            addItem();
                        }
                    }
                }
            };
        },
        <span class="hljs-string">'todo-item'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                css: {
                    completed: <span class="hljs-keyword">this</span>.completed,
                    editing: <span class="hljs-keyword">this</span>.editMode
                },
                event: {
                    dblclick: <span class="hljs-keyword">this</span>.beginEdit
                }
            };
        },
        <span class="hljs-string">'todo-edit'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">this</span>;

            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.title,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            item.endEdit();
                        }!!* <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.keyCode === ESCAPE_KEY) {
                            item.cancelEdit();
                        }**!
                    },
                    blur: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        item.endEdit();
                    }
                },
                hasFocus: <span class="hljs-keyword">this</span>.editMode
            };
        }
    };
});
</code></pre>
<p>This can be tested by editing an item and instead of hitting the enter key, hit the escape key. 
The previous title will be restored.</p>
<p>There are still some issues with the view not displaying the correct data so this is next on our list.</p>
<p><br></p>
<h3 id="11-display-the-current-number-of-items">11. Display the Current Number of Items</h3>
<p>The tricky thing about this is the fact that we need to put the number in a <code>&lt;strong&gt;</code> tag, but right next
to it we need to also display some text. This is where virtual bindings also help, since we want
to bind something without introducing a new parent div. We will define a data-class, <code>todo-count-text</code>, 
which will display the gramatically correct form of &#39;items&#39; based on the #. We will bind the <code>&lt;strong&gt;</code> element
directly to the number of items (e.g. <code>length</code>)</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: checkAll"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: items"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: completed"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"click: remove"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-edit"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        !!*<span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">strong</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: items().length"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ko class:todo-count-text --&gt;</span>
            <span class="hljs-comment">&lt;!-- /ko --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>**!
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Hidden if no completed items are left --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span>&gt;</span>Clear completed (1)<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p><code>todo-count-text</code> needs to be defined:</p>
<p><sub><strong>todo/bindings/todoBindings.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
<span class="hljs-comment">/*jslint sloppy: true,unparam: true*/</span>
define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> ENTER_KEY = <span class="hljs-number">13</span>,
        ESCAPE_KEY = <span class="hljs-number">27</span>;

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'todo-visible'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                visible: <span class="hljs-keyword">this</span>.items().length &gt; <span class="hljs-number">0</span>
            };
        },
        <span class="hljs-string">'todo-input'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> addItem = <span class="hljs-keyword">this</span>.addItem;
            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.newItem,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            addItem();
                        }
                    }
                }
            };
        },
        <span class="hljs-string">'todo-item'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                css: {
                    completed: <span class="hljs-keyword">this</span>.completed,
                    editing: <span class="hljs-keyword">this</span>.editMode
                },
                event: {
                    dblclick: <span class="hljs-keyword">this</span>.beginEdit
                }
            };
        },
        <span class="hljs-string">'todo-edit'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">this</span>;

            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.title,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            item.endEdit();
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.keyCode === ESCAPE_KEY) {
                            item.cancelEdit();
                        }
                    },
                    blur: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        item.endEdit();
                    }
                },
                hasFocus: <span class="hljs-keyword">this</span>.editMode
            };
        }!!*,
        <span class="hljs-string">'todo-count-text'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                text: (<span class="hljs-keyword">this</span>.items().length === <span class="hljs-number">1</span> ? <span class="hljs-string">'item'</span> : <span class="hljs-string">'items'</span>) + <span class="hljs-string">' left'</span>
            };
        }**!
    };
});
</code></pre>
<p>Now the count has been implemented:</p>
<p><img src="./count.png" alt="Now I know how many items there are!"></p>
<p><br></p>
<h3 id="12-clear-completed">12. Clear completed</h3>
<p>We will introduce a new data-class, <code>todo-clear-completed</code>, to allow the users to clear all of the
completed items with just one click.</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: checkAll"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: items"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: completed"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"click: remove"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-edit"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">strong</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: items().length"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ko class:todo-count-text --&gt;</span>
            <span class="hljs-comment">&lt;!-- /ko --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Remove this if you don't implement routing --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"selected"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>All<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/active"</span>&gt;</span>Active<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/completed"</span>&gt;</span>Completed<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        !!*<span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-clear-completed"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>**!
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>This data class needs to support 3 things:</p>
<ul>
<li>Hide the element if there are no completed items</li>
<li>Show the number of completed items</li>
<li>Remove all completed items on click</li>
</ul>
<p>We implement the binding like so:</p>
<p><sub><strong>todo/bindings/todoBindings.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
<span class="hljs-comment">/*jslint sloppy: true,unparam: true*/</span>
define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> ENTER_KEY = <span class="hljs-number">13</span>,
        ESCAPE_KEY = <span class="hljs-number">27</span>;

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'todo-visible'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                visible: <span class="hljs-keyword">this</span>.items().length &gt; <span class="hljs-number">0</span>
            };
        },
        <span class="hljs-string">'todo-input'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> addItem = <span class="hljs-keyword">this</span>.addItem;
            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.newItem,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            addItem();
                        }
                    }
                }
            };
        },
        <span class="hljs-string">'todo-item'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                css: {
                    completed: <span class="hljs-keyword">this</span>.completed,
                    editing: <span class="hljs-keyword">this</span>.editMode
                },
                event: {
                    dblclick: <span class="hljs-keyword">this</span>.beginEdit
                }
            };
        },
        <span class="hljs-string">'todo-edit'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">this</span>;

            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.title,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            item.endEdit();
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.keyCode === ESCAPE_KEY) {
                            item.cancelEdit();
                        }
                    },
                    blur: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        item.endEdit();
                    }
                },
                hasFocus: <span class="hljs-keyword">this</span>.editMode
            };
        },
        <span class="hljs-string">'todo-count-text'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                text: (<span class="hljs-keyword">this</span>.items().length === <span class="hljs-number">1</span> ? <span class="hljs-string">'item'</span> : <span class="hljs-string">'items'</span>) + <span class="hljs-string">' left'</span>
            };
        }!!*,
        <span class="hljs-string">'todo-clear-completed'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                visible: <span class="hljs-keyword">this</span>.completedItems().length &gt; <span class="hljs-number">0</span>,
                text: <span class="hljs-string">'Clear completed ('</span> + <span class="hljs-keyword">this</span>.completedItems().length + <span class="hljs-string">')'</span>,
                click: <span class="hljs-keyword">this</span>.removeCompletedItems
            };
        }**!
    };
});
</code></pre>
<p>We referenced two new things here: a <code>completedItems</code> variable and a <code>removeCompletedItems</code> function,
therefore we must define them in the viewmodel.</p>
<p><sub><strong>todo/viewmodels/todoViewModels.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/itemViewModel'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    itemViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll!!*,
            completedItems;**!

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push(itemViewModel({ title: item, completed: <span class="hljs-literal">false</span> }, items));
            }
            newItem(<span class="hljs-string">""</span>);
        }

        !!*<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeCompletedItems</span><span class="hljs-params">()</span> {</span>
            completedItems().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>
                item.remove();
            });
        }**!

        checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });

        !!*completedItems = computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> items().where(<span class="hljs-string">"$.completed()"</span>).toArray();
        });**!

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll!!*,
            completedItems: completedItems,
            removeCompletedItems: removeCompletedItems**!
        };
    };
});
</code></pre>
<p>As per scalejs convention, we define our funtions after we define vars, and leave business logic to the end. </p>
<p>For <code>removeCompletedItems</code>, we simply iterate through each item (using <code>Array.prototype.forEach</code>) and
pass an annonymous function which will call <code>remove()</code> on each completed item.</p>
<p><code>completedItems</code> is a computed which will return the items where completed() is true. Again we are using
<a href="./best.html#linq">linq</a> but this time since we want to return an array (<code>linq</code> functions cast arrays to enumerables
by default) we need to call <code>toArray()</code> before it is returned.</p>
<p>Now you can see this is working by refreshing your page, adding items, marking some as completed and observing
the value of <em>clear completed</em> changing. Click on the button to remove all of the completed items.</p>
<p><br></p>
<h3 id="13-persistence">13. Persistence</h3>
<p>For persistence we will use <code>localStorage</code> to store and retrieve todos. Doing so will be very clean and concise
using <code>linq</code> and functional programming concepts.</p>
<p>We create two helper functions: <code>toItem</code> so that we can convert the <code>itemViewModel</code> to a plain object literal (so we
can stringify it and store it in <code>localStorage</code>) and <code>toItemViewModel</code> so we can convert items from <code>localStorage</code>
to an <code>itemViewModel</code></p>
<p>Since we are using <code>localStorage</code> we need to add it to the global vars so that JSLint won&#39;t complain.</p>
<p><sub><strong>todos/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define!!*,localStorage**! */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/itemViewModel'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    itemViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll,
            completedItems;

        !!*<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItem</span><span class="hljs-params">(itemVM)</span> {</span>
            <span class="hljs-keyword">return</span> {
                title: itemVM.title(),
                completed: itemVM.completed()
            };
        }**!

        !!*<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItemViewModel</span><span class="hljs-params">(item)</span> {</span>
            <span class="hljs-keyword">return</span> itemViewModel(item, items);
        }**!

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push(itemViewModel({ title: item, completed: <span class="hljs-literal">false</span> }, items));
            }
            newItem(<span class="hljs-string">""</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeCompletedItems</span><span class="hljs-params">()</span> {</span>
            completedItems().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>
                item.remove();
            });
        }

        checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });

        completedItems = computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> items().where(<span class="hljs-string">"$.completed()"</span>).toArray();
        });

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll,
            completedItems: completedItems,
            removeCompletedItems: removeCompletedItems
        };
    };
});
</code></pre>
<p>Now we also need to perform the logic that will store and retrive items to/from <code>localStorage</code>. We use the
<code>computed</code> to keep track of changes to items, stringify items and add them to <code>localStorage</code>. We
do not need to return anything.</p>
<p>Also, if our <code>localStorage</code> is defined, then we need to <code>map</code> all of the to an <code>itemViewModel</code> using <code>toItemViewModel</code>.</p>
<p><sub><strong>todos/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define,localStorage */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/itemViewModel'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    itemViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll,
            completedItems;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItem</span><span class="hljs-params">(itemVM)</span> {</span>
            <span class="hljs-keyword">return</span> {
                title: itemVM.title(),
                completed: itemVM.completed()
            };
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItemViewModel</span><span class="hljs-params">(item)</span> {</span>
            <span class="hljs-keyword">return</span> itemViewModel(item, items);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push(itemViewModel({ title: item, completed: <span class="hljs-literal">false</span> }, items));
            }
            newItem(<span class="hljs-string">""</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeCompletedItems</span><span class="hljs-params">()</span> {</span>
            completedItems().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>
                item.remove();
            });
        }

        checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });

        completedItems = computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> items().where(<span class="hljs-string">"$.completed()"</span>).toArray();
        });

        !!*<span class="hljs-keyword">if</span> (has(localStorage[<span class="hljs-string">'todos-scalejs'</span>])) {
            items(<span class="hljs-built_in">JSON</span>.parse(localStorage[<span class="hljs-string">'todos-scalejs'</span>]).map(toItemViewModel));
        }**!

        !!*computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            localStorage[<span class="hljs-string">'todos-scalejs'</span>] = <span class="hljs-built_in">JSON</span>.stringify(items().map(toItem));
        });**!

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll,
            completedItems: completedItems,
            removeCompletedItems: removeCompletedItems
        };
    };
});
</code></pre>
<p>Since we have a <code>toItemViewModel</code> function, we can also simplify our <code>addItem</code> function by using that
instead of calling <code>itemViewModel</code> and passing the items.</p>
<p><sub><strong>todos/viewmodels/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define,localStorage */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/itemViewModel'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    itemViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll,
            completedItems;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItem</span><span class="hljs-params">(itemVM)</span> {</span>
            <span class="hljs-keyword">return</span> {
                title: itemVM.title(),
                completed: itemVM.completed()
            };
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItemViewModel</span><span class="hljs-params">(item)</span> {</span>
            <span class="hljs-keyword">return</span> itemViewModel(item, items);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                !!*items.push(toItemViewModel({ title: item, completed: <span class="hljs-literal">false</span> }));**!
            }
            newItem(<span class="hljs-string">""</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeCompletedItems</span><span class="hljs-params">()</span> {</span>
            completedItems().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>
                item.remove();
            });
        }

        checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });

        completedItems = computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> items().where(<span class="hljs-string">"$.completed()"</span>).toArray();
        });

        <span class="hljs-keyword">if</span> (has(localStorage[<span class="hljs-string">'todos-scalejs'</span>])) {
            items(<span class="hljs-built_in">JSON</span>.parse(localStorage[<span class="hljs-string">'todos-scalejs'</span>]).map(toItemViewModel));
        }

        computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            localStorage[<span class="hljs-string">'todos-scalejs'</span>] = <span class="hljs-built_in">JSON</span>.stringify(items().map(toItem));
        });

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll,
            completedItems: completedItems,
            removeCompletedItems: removeCompletedItems
        };
    };
});
</code></pre>
<p>Now we have implemented persistence. </p>
<p><br></p>
<h3 id="14-routing">14. Routing</h3>
<p>Routing can be implemented via a scalejs <a href="./extension.html">extension</a>, <a href="./routing.html">&#39;scalejs.routing-history&#39;</a>.
To have access to the <code>routing</code> namespace, we must include it in our project via <a href="http://www.nuget.org/">NuGet</a></p>
<p><strong>Right-click</strong> on the <em>ToDoMVC</em> project and select <strong>Manage NuGet Packages</strong></p>
<p><img src="./nuget1.png" alt="Select &#39;Manage NuGet Packages&#39;"></p>
<p>Search for <strong>scalejs.routing</strong> from the NuGet Package Manager window. 
At the time of this writing, routing is implemented using <a href="https://github.com/browserstate/history.js/">history.js</a> so it is the only one available.
Select it and click &quot;Install&quot;</p>
<p><img src="./nuget2.png" alt="scalejs.routing-historyjs"></p>
<p>We need to add the router to the app. Our <em>main</em> state needs to be a child to a <em>router</em> state so that the router 
can listen to and react to changes. </p>
<p>The way routing is implemented is via states by defining a property on the state called <code>route</code>. This allows
the url to be updated whenever the state is entered, and also when one navigates to a url for a specific state
the state becomes active.</p>
<p>We need to change our <strong>mainModule</strong> slightly to implement this change. We must register the <code>routerState()</code> which
we can get from <code>sandbox.routing</code> as a child of the <code>app</code> state. Then we must define our <code>main</code> state as 
a child of the <code>router</code> state.</p>
<p><sub><strong>main/mainModule.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!main'</span>,
    <span class="hljs-string">'app/main/viewmodels/mainViewModel'</span>,
    <span class="hljs-string">'views!main'</span>,
    <span class="hljs-string">'bindings!main'</span>,
    <span class="hljs-string">'styles!main'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    mainViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> <span class="hljs-comment">// imports</span>
            root = sandbox.mvvm.root,
            template = sandbox.mvvm.template,
            registerStates = sandbox.state.registerStates,
            state = sandbox.state.builder.state,
            onEntry = sandbox.state.builder.onEntry,
            !!*routerState = sandbox.routing.routerState,
            route = sandbox.routing.route,**!
            <span class="hljs-comment">// vars</span>
            mainVM = mainViewModel();

        <span class="hljs-comment">// Register application state for the module.</span>
        registerStates(<span class="hljs-string">'root'</span>,
            state(<span class="hljs-string">'app'</span>,
                !!*routerState(**!
                    state(<span class="hljs-string">'main'</span>,
                        onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                            <span class="hljs-comment">// create state properties for rendering todo module templates</span>
                            <span class="hljs-keyword">this</span>.todoItems = mainVM.todoItems;
                            <span class="hljs-keyword">this</span>.todoInput = mainVM.todoInput;
                            <span class="hljs-comment">// Render viewModel using 'main_template' template </span>
                            <span class="hljs-comment">// (defined in main.html) and show it in the `root` region.</span>
                            root(template(<span class="hljs-string">'main_template'</span>, mainVM));
                        })))));
    };
});
</code></pre>
<p>To make it possible to switch between <em>all</em>, <em>active</em> and <em>completed</em>, we need to introduce an array containing
these options in viewmodel that the view will bind to using <code>foreach</code>.</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: checkAll"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: items"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: completed"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"click: remove"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-edit"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">strong</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: items().length"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ko class:todo-count-text --&gt;</span>
            <span class="hljs-comment">&lt;!-- /ko --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        !!*<span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: viewableOptions"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-view"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>**!
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-clear-completed"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>We need to define <code>viewableOptions</code> in the viewmodel. Each viewableOption has the name of what will be
displayed in the footer of our todo list (e.g. &#39;All&#39;, &#39;Active&#39;, and &#39;Completed&#39;) as well as a function
which will raise a statechart event. We will need to subscribe to and react to this event in our statechart.</p>
<p><sub><strong>todo/viewmodel/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define,localStorage */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/itemViewModel'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    itemViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
              !!*raise = sandbox.state.raise,**!
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll,
            completedItems!!*,
            viewableOptions;**!


        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItem</span><span class="hljs-params">(itemVM)</span> {</span>
            <span class="hljs-keyword">return</span> {
                title: itemVM.title(),
                completed: itemVM.completed()
            };
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItemViewModel</span><span class="hljs-params">(item)</span> {</span>
            <span class="hljs-keyword">return</span> itemViewModel(item, items);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push(toItemViewModel({ title: item, completed: <span class="hljs-literal">false</span> }));
            }
            newItem(<span class="hljs-string">""</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeCompletedItems</span><span class="hljs-params">()</span> {</span>
            completedItems().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>
                item.remove();
            });
        }

        checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });

        completedItems = computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> items().where(<span class="hljs-string">"$.completed()"</span>).toArray();
        });

        !!*viewableOptions = [<span class="hljs-string">'All'</span>, <span class="hljs-string">'Active'</span>, <span class="hljs-string">'Completed'</span>].map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">return</span> {
                name: name,
                raiseEvent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    raise(<span class="hljs-string">'todo.'</span> + name);
                }
            };
        });**!

        <span class="hljs-keyword">if</span> (has(localStorage[<span class="hljs-string">'todos-scalejs'</span>])) {
            items(<span class="hljs-built_in">JSON</span>.parse(localStorage[<span class="hljs-string">'todos-scalejs'</span>]).map(toItemViewModel));
        }

        computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            localStorage[<span class="hljs-string">'todos-scalejs'</span>] = <span class="hljs-built_in">JSON</span>.stringify(items().map(toItem));
        });

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll,
            completedItems: completedItems,
            removeCompletedItems: removeCompletedItems!!*,
            viewableOptions: viewableOptions**!
        };
    };
});
</code></pre>
<p>We also need to define the <code>todo-view</code> data-class.</p>
<p><sub><strong>todo/bindings/todoBindings.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
<span class="hljs-comment">/*jslint sloppy: true,unparam: true*/</span>
define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> ENTER_KEY = <span class="hljs-number">13</span>,
        ESCAPE_KEY = <span class="hljs-number">27</span>;

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'todo-visible'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                visible: <span class="hljs-keyword">this</span>.items().length &gt; <span class="hljs-number">0</span>
            };
        },
        <span class="hljs-string">'todo-input'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> addItem = <span class="hljs-keyword">this</span>.addItem;
            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.newItem,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            addItem();
                        }
                    }
                }
            };
        },
        <span class="hljs-string">'todo-item'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                css: {
                    completed: <span class="hljs-keyword">this</span>.completed,
                    editing: <span class="hljs-keyword">this</span>.editMode
                },
                event: {
                    dblclick: <span class="hljs-keyword">this</span>.beginEdit
                }
            };
        },
        <span class="hljs-string">'todo-edit'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">this</span>;

            <span class="hljs-keyword">return</span> {
                value: <span class="hljs-keyword">this</span>.title,
                valueUpdate: <span class="hljs-string">'afterkeydown'</span>,
                event: {
                    keyup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, e)</span> {</span>
                        <span class="hljs-keyword">if</span> (e.keyCode === ENTER_KEY) {
                            item.endEdit();
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.keyCode === ESCAPE_KEY) {
                            item.cancelEdit();
                        }
                    },
                    blur: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        item.endEdit();
                    }
                },
                hasFocus: <span class="hljs-keyword">this</span>.editMode
            };
        },
        <span class="hljs-string">'todo-count-text'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                text: (<span class="hljs-keyword">this</span>.items().length === <span class="hljs-number">1</span> ? <span class="hljs-string">'item'</span> : <span class="hljs-string">'items'</span>) + <span class="hljs-string">' left'</span>
            };
        },
        <span class="hljs-string">'todo-clear-completed'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> {
                visible: <span class="hljs-keyword">this</span>.completedItems().length &gt; <span class="hljs-number">0</span>,
                text: <span class="hljs-string">'Clear completed ('</span> + <span class="hljs-keyword">this</span>.completedItems().length + <span class="hljs-string">')'</span>,
                click: <span class="hljs-keyword">this</span>.removeCompletedItems
            };
        }!!*,
        <span class="hljs-string">'todo-view'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ctx)</span> {</span>
            <span class="hljs-keyword">return</span> {
                text: <span class="hljs-keyword">this</span>.name,
                click: <span class="hljs-keyword">this</span>.raiseEvent,
                css: { selected: ctx.$parent.currentView() === <span class="hljs-keyword">this</span>.name }
            };
        }**!
    };
});
</code></pre>
<p>We will define three children states in our <code>todo</code> state: <code>todo.all</code>, <code>todo.active</code> and <code>todo.completed</code>.</p>
<p>When we enter these states, we need to update our viewModel to reflect the state that is entered.</p>
<p>We also need to define the transition that will occur when the events are raised. We use <code>gotoInternally</code> because
we do not want to exit the child state when we are switching between two child states.</p>
<p><sub><strong>todo/todoModule.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/todoViewModel'</span>,
    <span class="hljs-string">'bindings!todo'</span>,
    <span class="hljs-string">'views!todo'</span>,
    <span class="hljs-string">'styles!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    todoViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">todoModule</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> <span class="hljs-comment">// imports</span>
            root = sandbox.mvvm.root,
            template = sandbox.mvvm.template,
            registerStates = sandbox.state.registerStates,
            state = sandbox.state.builder.state,
            onEntry = sandbox.state.builder.onEntry,
            !!*on = sandbox.state.builder.on,
            gotoInternally = sandbox.state.builder.gotoInternally,**!
            <span class="hljs-comment">// vars</span>
            todo = todoViewModel(sandbox);

        <span class="hljs-comment">// Register application state for the module.</span>
        registerStates(<span class="hljs-string">'main'</span>,
            state(<span class="hljs-string">'todo'</span>,
                onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-comment">// pass the template bindings to the appropriate property</span>
                    <span class="hljs-keyword">this</span>.todoItems(template(<span class="hljs-string">'todo_items_template'</span>, todo));
                    <span class="hljs-keyword">this</span>.todoInput(template(<span class="hljs-string">'todo_input_template'</span>, todo));
                })!!*,
                on(<span class="hljs-string">'todo.All'</span>, gotoInternally(<span class="hljs-string">'todo.all'</span>)),
                on(<span class="hljs-string">'todo.Active'</span>, gotoInternally(<span class="hljs-string">'todo.active'</span>)),
                on(<span class="hljs-string">'todo.Completed'</span>, gotoInternally(<span class="hljs-string">'todo.completed'</span>)),
                state(<span class="hljs-string">'todo.all'</span>,
                    onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        todo.currentView(<span class="hljs-string">"All"</span>);
                    })),
                state(<span class="hljs-string">'todo.active'</span>,
                    onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        todo.currentView(<span class="hljs-string">"Active"</span>);
                    })),
                state(<span class="hljs-string">'todo.completed'</span>,
                    onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        todo.currentView
                    }))));**!
    };
});
</code></pre>
<p>Which means we need to define <code>currentView</code> in our viewmodel.</p>
<p><sub><strong>todo/viewmodel/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"> <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span class="hljs-comment">/*global define,localStorage */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/itemViewModel'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    itemViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
            raise = sandbox.state.raise,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll,
            completedItems,
            viewableOptions!!*,
            currentView = observable();**!


        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItem</span><span class="hljs-params">(itemVM)</span> {</span>
            <span class="hljs-keyword">return</span> {
                title: itemVM.title(),
                completed: itemVM.completed()
            };
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItemViewModel</span><span class="hljs-params">(item)</span> {</span>
            <span class="hljs-keyword">return</span> itemViewModel(item, items);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push(toItemViewModel({ title: item, completed: <span class="hljs-literal">false</span> }));
            }
            newItem(<span class="hljs-string">""</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeCompletedItems</span><span class="hljs-params">()</span> {</span>
            completedItems().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>
                item.remove();
            });
        }

        checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });

        completedItems = computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> items().where(<span class="hljs-string">"$.completed()"</span>).toArray();
        });

        viewableOptions = [<span class="hljs-string">'All'</span>, <span class="hljs-string">'Active'</span>, <span class="hljs-string">'Completed'</span>].map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">return</span> {
                name: name,
                raiseEvent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    raise(<span class="hljs-string">'todo.'</span> + name);
                }
            };
        });

        <span class="hljs-keyword">if</span> (has(localStorage[<span class="hljs-string">'todos-scalejs'</span>])) {
            items(<span class="hljs-built_in">JSON</span>.parse(localStorage[<span class="hljs-string">'todos-scalejs'</span>]).map(toItemViewModel));
        }

        computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            localStorage[<span class="hljs-string">'todos-scalejs'</span>] = <span class="hljs-built_in">JSON</span>.stringify(items().map(toItem));
        });

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll,
            completedItems: completedItems,
            removeCompletedItems: removeCompletedItems,
            viewableOptions: viewableOptions!!*,
            currentView: currentView**!
        };
    };
});
</code></pre>
<p>We need to modify how we are showing the items so that the correct items are being displayed while
also maintaining a list of all of the items. We will define a new computed, <code>viewableItems</code> which will
react to changes in <code>currentView</code> and <code>items</code>.</p>
<p><sub><strong>todo/viewmodel/todoViewModel.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define,localStorage */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/itemViewModel'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    itemViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> observableArray = sandbox.mvvm.observableArray,
            observable = sandbox.mvvm.observable,
            has = sandbox.object.has,
            computed = sandbox.mvvm.computed,
            raise = sandbox.state.raise,
            <span class="hljs-comment">//properties</span>
            items = observableArray(),
            newItem = observable(),
            checkAll,
            completedItems,
            viewableOptions,
            currentView = observable()!!*,
            viewableItems;**!


        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItem</span><span class="hljs-params">(itemVM)</span> {</span>
            <span class="hljs-keyword">return</span> {
                title: itemVM.title(),
                completed: itemVM.completed()
            };
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toItemViewModel</span><span class="hljs-params">(item)</span> {</span>
            <span class="hljs-keyword">return</span> itemViewModel(item, items);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> item = newItem();
            <span class="hljs-keyword">if</span> (has(item, <span class="hljs-string">"trim"</span>) &amp;&amp; item.trim()) {
                items.push(toItemViewModel({ title: item, completed: <span class="hljs-literal">false</span> }));
            }
            newItem(<span class="hljs-string">""</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeCompletedItems</span><span class="hljs-params">()</span> {</span>
            completedItems().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span>
                item.remove();
            });
        }

        checkAll = computed({
            read: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">return</span> items().all(<span class="hljs-string">"$.completed()"</span>);
            },
            write: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
                items().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span> item.completed(value); });
            }
        });

        completedItems = computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> items().where(<span class="hljs-string">"$.completed()"</span>).toArray();
        });

        viewableOptions = [<span class="hljs-string">'All'</span>, <span class="hljs-string">'Active'</span>, <span class="hljs-string">'Completed'</span>].map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">return</span> {
                name: name,
                raiseEvent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    raise(<span class="hljs-string">'todo.'</span> + name);
                }
            };
        });

        !!*viewableItems = computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> view = currentView();

            <span class="hljs-keyword">if</span> (view === <span class="hljs-string">'Active'</span>) {
                <span class="hljs-keyword">return</span> items().where(<span class="hljs-string">"!$.completed()"</span>).toArray();
            }

            <span class="hljs-keyword">if</span> (view === <span class="hljs-string">'Completed'</span>) {
                <span class="hljs-keyword">return</span> items().where(<span class="hljs-string">"$.completed()"</span>).toArray();
            }

            <span class="hljs-keyword">return</span> items();
        });**!

        <span class="hljs-keyword">if</span> (has(localStorage[<span class="hljs-string">'todos-scalejs'</span>])) {
            items(<span class="hljs-built_in">JSON</span>.parse(localStorage[<span class="hljs-string">'todos-scalejs'</span>]).map(toItemViewModel));
        }

        computed(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            localStorage[<span class="hljs-string">'todos-scalejs'</span>] = <span class="hljs-built_in">JSON</span>.stringify(items().map(toItem));
        });

        <span class="hljs-keyword">return</span> {
            items: items,
            newItem: newItem,
            addItem: addItem,
            checkAll: checkAll,
            completedItems: completedItems,
            removeCompletedItems: removeCompletedItems,
            viewableOptions: viewableOptions,
            currentView: currentView,
            !!*viewableItems: viewableItems**!
        };
    };
});
</code></pre>
<p>Now we need to bind our list to <code>viewableItems</code> instead of <code>items</code>.</p>
<p><sub><strong>todo/views/todo.html</strong></sub></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_items_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"main"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"toggle-all"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: checkAll"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"toggle-all"</span>&gt;</span>Mark all as complete<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
        !!*<span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-list"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: viewableItems"</span>&gt;</span>**!
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"toggle"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"checked: completed"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"destroy"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"click: remove"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"edit"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-edit"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"footer"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-visible"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo-count"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">strong</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"text: items().length"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ko class:todo-count-text --&gt;</span>
            <span class="hljs-comment">&lt;!-- /ko --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filters"</span> <span class="hljs-attribute">data-bind</span>=<span class="hljs-value">"foreach: viewableOptions"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-view"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"clear-completed"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-clear-completed"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"todo_input_template"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new-todo"</span> <span class="hljs-attribute">data-class</span>=<span class="hljs-value">"todo-input"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"What needs to be done?"</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre>
<p>So far, so good. Now we will begin to introduce our routing into our states by simply passing <code>route</code> into the state
with the text we would like to see in our URL. For the root, we specifiy &#39;/&#39;.</p>
<p><sub><strong>todo/todoModule.js</strong></sub></p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">/*global define */</span>
define([
    <span class="hljs-string">'sandbox!todo'</span>,
    <span class="hljs-string">'app/todo/viewmodels/todoViewModel'</span>,
    <span class="hljs-string">'bindings!todo'</span>,
    <span class="hljs-string">'views!todo'</span>,
    <span class="hljs-string">'styles!todo'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    sandbox,
    todoViewModel
)</span> {</span>
<span class="hljs-pi">    'use strict'</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">todoModule</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> <span class="hljs-comment">// imports</span>
            root = sandbox.mvvm.root,
            template = sandbox.mvvm.template,
            registerStates = sandbox.state.registerStates,
            state = sandbox.state.builder.state,
            onEntry = sandbox.state.builder.onEntry,
            on = sandbox.state.builder.on,
            gotoInternally = sandbox.state.builder.gotoInternally,
            !!*route = sandbox.routing.route,**!
            <span class="hljs-comment">// vars</span>
            todo = todoViewModel(sandbox);

        <span class="hljs-comment">// Register application state for the module.</span>
        registerStates(<span class="hljs-string">'main'</span>,
            state(<span class="hljs-string">'todo'</span>,
                onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-comment">// pass the template bindings to the appropriate property</span>
                    <span class="hljs-keyword">this</span>.todoItems(template(<span class="hljs-string">'todo_items_template'</span>, todo));
                    <span class="hljs-keyword">this</span>.todoInput(template(<span class="hljs-string">'todo_input_template'</span>, todo));
                }),
                on(<span class="hljs-string">'todo.All'</span>, gotoInternally(<span class="hljs-string">'todo.all'</span>)),
                on(<span class="hljs-string">'todo.Active'</span>, gotoInternally(<span class="hljs-string">'todo.active'</span>)),
                on(<span class="hljs-string">'todo.Completed'</span>, gotoInternally(<span class="hljs-string">'todo.completed'</span>)),
                state(<span class="hljs-string">'todo.all'</span>,
                    !!*route(<span class="hljs-string">'/'</span>),**!
                    onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        todo.currentView(<span class="hljs-string">"All"</span>);
                    })),
                state(<span class="hljs-string">'todo.active'</span>,
                    !!*route(<span class="hljs-string">'active'</span>),**!
                    onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        todo.currentView(<span class="hljs-string">"Active"</span>);
                    })),
                state(<span class="hljs-string">'todo.completed'</span>,
                    !!*route(<span class="hljs-string">'completed'</span>),**!
                    onEntry(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        todo.currentView(<span class="hljs-string">"Completed"</span>);
                    }))));
    };
});
</code></pre>
<p>This is all that is needed to implement routing. Check it out for yourself! </p>
<h2 id="summary">Summary</h2>
<p>You have completed the ToDoMVC tutorial. Have a Cookie!</p>
<p><img src="https://fling.seas.upenn.edu/~asme/dynamic/wordpress/wp-content/uploads/2012/09/cookie.jpg" alt="YUMM"></p>

	    </div>

  </div>
</div>
    
</body>
</html>