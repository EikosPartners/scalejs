{"version":3,"sources":["../src/scalejs.core.js"],"names":[],"mappings":";;;;;;AAOA;;;;;;;AAII,IAAI,MAAc,kBAAK,MAAL,CAAY,GAA9B;AAAA,IACI,KAAc,kBAAK,IAAL,CAAU,EAD5B;AAAA,IAEI,SAAc,kBAAK,MAAL,CAAY,MAF9B;AAAA,IAGI,SAAc,kBAAK,KAAL,CAAW,MAH7B;AAAA,IAII,QAAc,kBAAK,GAAL,CAAS,KAJ3B;AAAA;;;;;;;;;AAaI,OAA8B,EAblC;AAAA;;;;;;;;AAqBI,aAA8B,EArBlC;AAAA;;;;;;;;AA6BI,4BAA8B,EA7BlC;AAAA;;;;;;;;AAqCI,wBAA8B,KArClC;;;;;;;;;;;;;;;;AA8CA,SAAS,iBAAT,CAA2B,SAA3B,EAAsC;AAClC,QAAI;AACA,YAAI,GAAJ,C;;AAEA,YAAI,GAAG,SAAH,EAAc,WAAd,EAA2B,UAA3B,CAAJ,EAA4C;;AAExC,sBAAU,SAAV,CAAoB,IAApB;AACA,mBAAO,UAAP,EAAmB,SAAnB;AACA,mB;AACH;;AAED,YAAI,GAAG,SAAH,EAAc,UAAd,CAAJ,EAA+B;;AAE3B,kBAAM,UAAU,IAAV,CAAN;AACH,SAHD,MAIK,IAAI,IAAI,SAAJ,EAAe,MAAf,CAAJ,EAA4B;;AAE7B,kBAAM,UAAU,IAAhB;AACH,SAHI,MAIA;;AAED,kBAAM,SAAN;AACH;;AAED,YAAI,GAAJ,EAAS;AACL,mBAAO,IAAP,EAAa,GAAb;AACA,mBAAO,UAAP,EAAmB,SAAnB;AACH;AAEJ,KA5BD,CA4BE,OAAO,EAAP,EAAW;AACT,cAAM,iDAAN,EACQ,uCADR,EAEQ,SAFR,EAGQ,2CAHR,EAIQ,EAJR;AAKH;;AAED,WAAO,SAAP;AACH;;;;;;;;;AASD,SAAS,YAAT,CAAsB,EAAtB,EAA0B;AACtB,QAAI,CAAC,IAAI,EAAJ,CAAL,EAAc;AACV,cAAM,IAAI,KAAJ,CAAU,8CAAV,CAAN;AACH;;;AAGD,QAAI,UAAU;AACV,cAAQ,KAAK,IADH;AAEV,gBAAQ,KAAK,MAFH;AAGV,eAAQ,KAAK,KAHH;AAIV,aAAQ,KAAK;AAJH,KAAd;;;AAQA,eAAW,OAAX,CAAmB,UAAU,SAAV,EAAqB;AACpC,YAAI;;;AAGA,gBAAI,GAAG,SAAH,EAAc,cAAd,EAA8B,UAA9B,CAAJ,EAA+C;AAC3C,0BAAU,YAAV,CAAuB,OAAvB;AACH;;;AAFD,iBAKK,IAAI,IAAI,SAAJ,EAAe,SAAf,CAAJ,EAA+B;AAChC,2BAAO,OAAP,EAAgB,UAAU,OAA1B;AACH;;;AAFI,qBAKA;AACD,+BAAO,OAAP,EAAgB,SAAhB;AACH;AAEJ,SAjBD,CAiBE,OAAO,EAAP,EAAW;AACT,kBAAM,iDAAN,EACM,0CADN,EAEM,SAFN,EAGM,2CAHN,EAIM,EAJN;AAKA,kBAAM,EAAN;AACH;AACJ,KA1BD;;AA4BA,WAAO,OAAP;AACH;;;;;;;;;AASD,SAAS,kBAAT,CAA4B,QAA5B,EAAsC;AAClC,8BAA0B,IAA1B,CAA+B,QAA/B;AACH;;;;;;;AAOD,SAAS,wBAAT,GAAoC;AAChC,QAAI,qBAAJ,EAA0B;AAAE;AAAS;;AAErC,4BAAuB,IAAvB;AACA,8BAA0B,OAA1B,CAAkC,UAAU,QAAV,EAAoB;AAClD,iBAAS,SAAT;AACH,KAFD;AAGH;;;;;;;AAOD,SAAS,wBAAT,GAAoC;AAChC,QAAI,CAAC,qBAAL,EAA2B;AAAE;AAAS;;AAEtC,4BAAuB,KAAvB;AACA,8BAA0B,OAA1B,CAAkC,UAAU,QAAV,EAAoB;AAClD,iBAAS,SAAT;AACH,KAFD;AAGH;;;;;;;;;AASD,OAAO,cAAP,CAAsB,IAAtB,EAA4B,SAA5B,EAAuC;AACnC,WAAO,SAD4B;AAEnC,cAAU;AAFyB,CAAvC;;;;;;;;;AAYA,OAAO,cAAP,CAAsB,IAAtB,EAA4B,SAA5B,EAAuC;AACnC,WAAO,SAD4B;AAEnC,cAAU;AAFyB,CAAvC;;kBAKe,OAAO,IAAP,EAAa;AACxB,UAA4B,kBAAK,IADT;AAExB,YAA4B,kBAAK,MAFT;AAGxB,WAA4B,kBAAK,KAHT;AAIxB,SAA4B,kBAAK,GAJT;AAKxB,kBAA4B,YALJ;AAMxB,8BAA4B,wBANJ;AAOxB,8BAA4B,wBAPJ;AAQxB,wBAA4B,kBARJ;AASxB,uBAA4B,iBATJ;;;;;;;AAgBxB,0BAAsB,gCAAY;AAAE,eAAO,qBAAP;AAA8B;;AAhB1C,CAAb,C","file":"scalejs.core.js","sourcesContent":["/**\r\n * Provides core functionality of scalejs\r\n * @namespace scalejs.core\r\n * @module core\r\n */\r\n\r\n/*global define*/\r\nimport base from './scalejs.base';\r\n    \r\n\r\n    // Imports\r\n    var has         = base.object.has,\r\n        is          = base.type.is,\r\n        extend      = base.object.extend,\r\n        addOne      = base.array.addOne,\r\n        error       = base.log.error,\r\n\r\n        /**\r\n         * Holds the core\r\n         * @property self\r\n         * @type Object\r\n         * @memberOf core\r\n         * @private\r\n         */\r\n        self                        = { },\r\n        /**\r\n         * Holds extensions for the core and sandbox\r\n         * @property extensions\r\n         * @type Array\r\n         * @memberOf core\r\n         * @private\r\n         */\r\n        extensions                  = [ ],\r\n        /**\r\n         * Holds application event listeners\r\n         * @property applicationEventListeners\r\n         * @type Array\r\n         * @memberOf core\r\n         * @private\r\n         */\r\n        applicationEventListeners   = [ ],\r\n        /**\r\n         * Holds the current application state\r\n         * @property isApplicationRunning\r\n         * @type Boolean\r\n         * @memberOf core\r\n         * @private\r\n         */\r\n        isApplicationRunning        = false;\r\n\r\n    /**\r\n     * Registers an extension to the sandbox\r\n     *\r\n     * @param {Function|Object} extension function to create the extension or\r\n     *                                    object representing the extension\r\n     * @memberOf core\r\n     */\r\n    function registerExtension(extension) {\r\n        try {\r\n            var ext; // Actual extension\r\n\r\n            if (is(extension, 'buildCore', 'function')) {\r\n            // If extension has buildCore function then give it an instance of the core.\r\n                extension.buildCore(self);\r\n                addOne(extensions, extension);\r\n                return; // No need to extend as that will be handled in buildCore\r\n            }\r\n\r\n            if (is(extension, 'function')) {\r\n            // If extension is a function then give it an instance of the core.\r\n                ext = extension(self);\r\n            }\r\n            else if (has(extension, 'core')) {\r\n            // If extension has `core` property then extend core with it.\r\n                ext = extension.core;\r\n            }\r\n            else {\r\n            // Otherwise extend core with the extension itself.\r\n                ext = extension;\r\n            }\r\n\r\n            if (ext) {\r\n                extend(self, ext);\r\n                addOne(extensions, extension);\r\n            }\r\n\r\n        } catch (ex) {\r\n            error('Fatal error during application initialization. ',\r\n                    'Failed to build core with extension \"',\r\n                    extension,\r\n                    'See following exception for more details.',\r\n                    ex);\r\n        }\r\n        \r\n        return extension;\r\n    }\r\n\r\n    /**\r\n     * Builds a sandbox from the current list of extensions\r\n     *\r\n     * @param {String} id identifier for the sandbox\r\n     * @memberOf core\r\n     * @return {Object} object representing the built sandbox\r\n     */\r\n    function buildSandbox(id) {\r\n        if (!has(id)) {\r\n            throw new Error('Sandbox name is required to build a sandbox.');\r\n        }\r\n\r\n        // Create module instance specific sandbox\r\n        var sandbox = {\r\n            type:   self.type,\r\n            object: self.object,\r\n            array:  self.array,\r\n            log:    self.log\r\n        };\r\n\r\n        // Add extensions to sandbox\r\n        extensions.forEach(function (extension) {\r\n            try {\r\n\r\n                // If extension has buildSandbox method use it to build sandbox\r\n                if (is(extension, 'buildSandbox', 'function')) {\r\n                    extension.buildSandbox(sandbox);\r\n                }\r\n\r\n                // If extension has a sandbox object add it\r\n                else if (has(extension, 'sandbox')) {\r\n                    extend(sandbox, extension.sandbox);\r\n                }\r\n\r\n                // Otherwise extend the sandbox with the extension\r\n                else {\r\n                    extend(sandbox, extension);\r\n                }\r\n\r\n            } catch (ex) {\r\n                error('Fatal error during application initialization. ',\r\n                      'Failed to build sandbox with extension \"',\r\n                      extension,\r\n                      'See following exception for more details.',\r\n                      ex);\r\n                throw ex;\r\n            }\r\n        });\r\n\r\n        return sandbox;\r\n    }\r\n\r\n    /**\r\n     * Adds a listener to the application event\r\n     *\r\n     * @param {Function} listener called on application event\r\n     * @param {String}   listener.message event description\r\n     * @memberOf core\r\n     */\r\n    function onApplicationEvent(listener) {\r\n        applicationEventListeners.push(listener);\r\n    }\r\n\r\n    /**\r\n     * Notify the event listeners the application has started\r\n     *\r\n     * @memberOf core\r\n     */\r\n    function notifyApplicationStarted() {\r\n        if (isApplicationRunning) { return; }\r\n\r\n        isApplicationRunning = true;\r\n        applicationEventListeners.forEach(function (listener) {\r\n            listener('started');\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Notify the event listeners the application has stopped\r\n     *\r\n     * @memberOf core\r\n     */\r\n    function notifyApplicationStopped() {\r\n        if (!isApplicationRunning) { return; }\r\n\r\n        isApplicationRunning = false;\r\n        applicationEventListeners.forEach(function (listener) {\r\n            listener('stopped');\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Constant for notifying application start\r\n     *\r\n     * @property STARTED\r\n     * @type String\r\n     * @memberOf core\r\n     */\r\n    Object.defineProperty(self, 'STARTED', {\r\n        value: 'started',\r\n        writable: false\r\n    });\r\n\r\n    /**\r\n     * Constant for notifying application stop\r\n     *\r\n     * @property STOPPED\r\n     * @type String\r\n     * @memberOf core\r\n     */\r\n    Object.defineProperty(self, 'STOPPED', {\r\n        value: 'stopped',\r\n        writable: false\r\n    });\r\n\r\n    export default extend(self, {\r\n        type:                       base.type,\r\n        object:                     base.object,\r\n        array:                      base.array,\r\n        log:                        base.log,\r\n        buildSandbox:               buildSandbox,\r\n        notifyApplicationStarted:   notifyApplicationStarted,\r\n        notifyApplicationStopped:   notifyApplicationStopped,\r\n        onApplicationEvent:         onApplicationEvent,\r\n        registerExtension:          registerExtension,\r\n        /**\r\n         * Accesses the current state of the application\r\n         *\r\n         * @memberOf core\r\n         * @return {Boolean} state of the application\r\n         */\r\n        isApplicationRunning: function () { return isApplicationRunning; }\r\n\r\n    });\r\n\r\n\r\n"]}